#!/bin/ksh

####################################################################         
# 
#   chkerr : Æ¯Á¤ SessionÀÇ SQLCODE¸¦ 1ÃÊ °£°ÝÀ¸·Î ¸ð´ÏÅÍ¸µ ÇÑ´Ù.
#                                 Ç¥ÁØ¹öÀü : v0.3
#
#   »ç¿ë¹ý : chkerr2 [Session ID]
#
####################################################################

# Tool Æú´õ ¼³Á¤ ########################################################
if [ ! "$TOOL" ]
then export TOOL=$HOME/tool
fi
#########################################################################


# OSº° awk ¼³Á¤ #########################################################
if [ `uname` = 'HP-UX' ]
then
   export CAWK=awk
else
   export CAWK=nawk
fi
#########################################################################


# ÀÓ½ÃÆÄÀÏ ÃÊ±âÈ­ #######################################################
export TempTail=`tty | $CAWK -F/ '{print $4}'`
export TempFile1=$TOOL/tmp/`echo $0 | $CAWK -F '/' '{ print $NF }'`.tmp_${TempTail}_$$

if [ -f $TempFile1 ]; then rm $TempFile1; fi
#########################################################################

echo '[0m\c'
################### Default #############################################


if [ ! "$1" ]
then
   echo '»ç¿ë¹ý : chkerr2 [Session ID]'
else

	while true
	do
		onstat -g sql $1 > $TempFile1
		errorcode=`grep ^$1' ' $TempFile1 | $CAWK -F ' ' '{ print $7; }'`
		if [ $errorcode -lt 0 ]
		then
			echo '====================================================================================='
			date
			echo '-------------------------------------------------------------------------------------'
			cat $TempFile1
			echo '====================================================================================='
			echo
			echo
		fi

		if [ -f $TempFile1 ]; then rm $TempFile1; fi
		sleep 1
	done

fi

