#!/bin/ksh

#########################################################################
#
#   colcnt : unl íŒŒì¼ì˜ í•œ í–‰ì˜ Column ê°¯ìˆ˜ë¥¼ ë³´ì—¬ì£¼ëŠ” Shell
#
#
#   ì‚¬ìš©ë²• : colcnt [Fileëª… | all] [Delimiter]
#
#########################################################################

# Tool í´ë” ì„¤ì • ########################################################
if [ ! "$TOOL" ]
then export TOOL=$HOME/tool
fi
#########################################################################


# OSë³„ awk ì„¤ì • #########################################################
if [ `uname` = 'HP-UX' ]
then
   export CAWK=awk
else
   export CAWK=nawk
fi
#########################################################################


# ì„ì‹œíŒŒì¼ ì´ˆê¸°í™” #######################################################
export TempTail=`tty | $CAWK -F/ '{print $4}'`
export TempFile1=$TOOL/tmp/`echo $0 | $CAWK -F '/' '{ print $NF }'`.tmp_${TempTail}_$$
export TempFile2=$TOOL/tmp/`echo $0 | $CAWK -F '/' '{ print $NF }'`.tmp2_${TempTail}_$$

if [ -f $TempFile1 ]; then rm $TempFile1; fi
if [ -f $TempFile2 ]; then rm $TempFile2; fi
#########################################################################


echo '[0m\c'
################### Default #############################################

if [ ! "$1" ]
then
	
	echo 'ì‚¬ìš©ë²• : colcnt [Fileëª… | all] [Delimiter]'
	
else
	
	if [ ! "$2" ]
	then export deli='|'
	else export deli=$2
	fi

	if [ $1 = "all" ]
	then ls *.unl > $TempFile2
	else echo $1 > $TempFile2
	fi

	for i in `cat $TempFile2`
	do

		head -1 $i > $TempFile1
		export a1=`ls -al $TempFile1 | $CAWK -F ' ' '{
			{ print $5 }
		}'`

		echo '1,$s/'$deli'//g\nw\nq' | ed $TempFile1 > /dev/null
		export a2=`ls -al $TempFile1 | $CAWK -F ' ' '{
			{ print $5 }
		}'`

		printf "%s%s %d%s\n" $i "ì˜ Column ê°¯ìˆ˜ëŠ”" `expr $a1 - $a2` "ê°œ ì…ë‹ˆë‹¤."

	done

fi

if [ -f $TempFile1 ]; then rm $TempFile1; fi
