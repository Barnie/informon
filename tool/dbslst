#!/bin/ksh

#########################################################################
#
#   dbslst : ì§€ì •ëœ dbspaceì— ìƒì„±ëœ Table ëª©ë¡ì„ ë³´ëŠ” Shellì…ë‹ˆë‹¤
#   ì‚¬ìš©ë²• : dbslst dbspaceëª… (DBëª…)
#   ê²°ê³¼ë¬¼ : tables_dbspaceëª…
#
#########################################################################

# Tool í´ë” ì„¤ì • ########################################################
if [ ! "$TOOL" ]
then export TOOL=$HOME/tool
fi
#########################################################################


# OSë³„ awk ì„¤ì • #########################################################
if [ `uname` = 'HP-UX' ]
then
   export CAWK=awk
else
   export CAWK=nawk
fi
#########################################################################

echo '[0m\c'
################### Default #############################################


if [ ! "$1" ]
then

	echo 'ì‚¬ìš©ë²• : dbslst dbspaceëª… (DBëª…)'

else

	if [ ! "$2" ]
	then 

		if [ -f tables_$1 ]; then rm tables_$1; fi

		dbaccess sysmaster<<! 1> /dev/null 2> /dev/null
			set isolation to dirty read;
			unload to tables_$1 delimiter ' '
			select 
			       distinct t.tabname, t.dbsname, t.owner
			  from sysptnext p, systabnames t
			 where p.pe_partnum = t. partnum
			   and dbinfo( "DBSPACE", p.pe_partnum ) = '$1'
			   and t.tabname not like "sys%"
			 order by 1;
!

		echo '---------------------------------------------'
		echo '[32;43m                   Object Name  Database Name[0m'
		echo '---------------------------------------------'
		cat tables_$1 | $CAWK -F ' ' '{
								{ printf("%30s  %-s  %s\n", $1, $2, $3); }
}'
		echo '---------------------------------------------'

	else 

		if [ -f tables_$1 ]; then rm tables_$1; fi

		dbaccess $2<<! 1> /dev/null 2> /dev/null
			set isolation to dirty read;
			unload to tables_$1 delimiter ' '
			select {+ORDERED}
			       distinct s.tabname
			  from systables s, sysmaster:sysptnext p
			 where dbinfo( "DBSPACE", p.pe_partnum ) = '$1'
			   and p.pe_partnum = s.partnum
			   and s.tabtype = 'T'
			   and s.tabid > 99
			 order by 1
!

		echo '------------------------------'
		echo '[32;43mObject Name                   [0m'
		echo '------------------------------'
		cat tables_$1
		echo '------------------------------'

	fi

fi
