#!/bin/ksh

####################################################################         
# 
#   droptab : Î≥¥Í¥ÄÍ∏∞Í∞ÑÏù¥ ÏßÄÎÇú TableÏùÑ DropÌïòÎäî ShellÏûÖÎãàÎã§
#
#   ÏÇ¨Ïö©Î≤ï : droptab (ÌòÑÏû¨ÏùºÏûê Ïù¥Ï†Ñ Î™áÏùº)
#   ÏöîÌååÏùº : ds, $TOOL/bin/dbcopy
#
####################################################################

# OSÎ≥Ñ awk ÏÑ§Ï†ï #########################################################
if [ `uname` = 'HP-UX' ]
then
   export CAWK=awk
else
   export CAWK=nawk
fi
#########################################################################

export TOOL=$HOME/tool
export TAX_PERS_NUMB="'EBA','GMK','INI','AUC','LGU'"

if [ ! "$1" ]
then export minus=0
else export minus=$1
fi

if [ `env | grep SCHEMADIR | wc -l` -lt 1 ]
then
	export SCHEMADIR=$INFORMIX/SCHEMA
fi 

while true
do ##### Main While Loop

###########################################
#   Ïö¥ÏòÅ/Î∞±ÏóÖ
###########################################

if [ $INFORMIXSERVER = 'pb01_tcp' ] || [ $INFORMIXSERVER = 'pbsec01_tcp' ]
then 

   echo
   echo '<< PBÏóÖÎ¨¥Í≥Ñ >>'
   echo '-------------------------------------------'
   echo '     ÏÇ≠Ï†úÌï† ÌÖåÏù¥Î∏îÏùò Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî'
   echo '-------------------------------------------'
   echo '     1) Ïùº Ï£ºÍ∏∞ ÌÖåÏù¥Î∏î'
   echo '     2) Ïõî Ï£ºÍ∏∞ ÌÖåÏù¥Î∏î'
   echo '     0) Îπ†Ï†∏ ÎÇòÍ∞ÄÍ∏∞'
   echo '-------------------------------------------'
   echo '     > \c'
   read yn
   echo

   if [ $yn -eq 1 ]; then

      echo
      echo '----------------------------------------'
      echo '   ÏÇ≠Ï†úÌï† ÌÖåÏù¥Î∏î Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.'
      echo '----------------------------------------'
      echo '   [5m1) Í∏∞Í∞ÑÎßåÎ£å 1Ï£ºÏùº (ÏßÄÏó∞Ï≤òÎ¶¨ Îì±)[0m'
      echo '   [5m2) Í∏∞Í∞ÑÎßåÎ£å ÌïúÎã¨  (Í±∞ÎûòÎÇ¥Ïó≠ Îì±) - ÌòÑÏû¨ÏóÜÏùå[0m'
      echo '   3) Î∞±ÏóÖÏôÑÎ£å ÌïúÎã¨  (ÏßÅÎ∂à,Íµ¨Îß§ Îì±) - ÌòÑÏû¨ÏóÜÏùå'
      echo '   4) Î∞±ÏóÖÏôÑÎ£å ÏÑùÎã¨  (Ìè¨Ïù∏Ìä∏ Îì±) - ÌòÑÏû¨ÏóÜÏùå'
      echo '   5) Î∞±ÏóÖÏôÑÎ£å 12Í∞úÏõî (Í∞ÄÎßπÏ†ê Í±∞ÎûòÍ≥†Ïú†Î≤àÌò∏ Îì±) - ÌòÑÏû¨ÏóÜÏùå'
      echo '   6) Î∞±ÏóÖÏôÑÎ£å 24Í∞úÏõî (ÏäπÏù∏ Îì±) - ÌòÑÏû¨ÏóÜÏùå'
		echo '   7) TLF ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ Ï†ÑÏö©ÏúºÎ°ú Ï†ÑÌôò 3Í∞úÏõî - ÌòÑÏû¨ÏóÜÏùå'
      if [ $INFORMIXSERVER = 'pbsec01_tcp' ] || [ $INFORMIXSERVER = 'pbtst01_tcp' ]; then
         echo '   [5m8) Í∏∞Í∞ÑÎßåÎ£å 1Ï£ºÏùº (Î™®ÎãàÌÑ∞ÎßÅ Îì±) - ÌòÑÏû¨ÏóÜÏùå[0m'
      fi
      echo '----------------------------------------'
      echo ' >> \c'
      read yn

      if [ $yn = "1" ];   then export period=7 ;  export bu=''
      elif [ $yn = "2" ]; then export period=31;  export bu=''
      elif [ $yn = "3" ]; then export period=31;  export bu='b'
      elif [ $yn = "4" ]; then export period=92;  export bu='b'
      elif [ $yn = "5" ]; then export period=366; export bu='b'
      elif [ $yn = "6" ]; then export period=730; export bu='b'
      elif [ $yn = "7" ]; then export period=92;  export bu='g'
      elif [ $yn = "8" ]; then export period=7;   export bu='m'
      else exit
      fi


      if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
      if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

      dbaccess dbname<<! 1> /dev/null 2> /dev/null
         set isolation to dirty read;
         unload to $TOOL/tmp/droptab.tmp delimiter ' '
         select first 1 to_char( today - $period - $minus, "%y%m%d" ) tabdate from dual;
!

      export dday=`cat $TOOL/tmp/droptab.tmp`

      if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

      for i in `cat ~informix/SCHEMA/tables_d_$period$bu`
      do
         dbaccess dbname<<! 1> /dev/null 2> /dev/null
            set isolation to dirty read;
            unload to $TOOL/tmp/droptab.tmp delimiter ' '
            select tabname from systables
             where tabid > 99 and tabtype='T'
               and tabname like '$i%'
               and tabname < '$i$dday'
               and length(tabname) = length('$i$dday')
               and tabname != '${i}yymmdd';
!
         cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
         if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
      done


      #############################
      #   TLFÎ•º ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨Ïö©ÏúºÎ°ú Ï†ÑÌôò
      #############################
      if [ x$bu = 'xg' ]; then

         echo
         echo 'Ïò§ÎäòÏùÄ '`date +"$ymd"`
         echo '------------------------------'
         echo '[5mÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ Ï†ÑÏö©ÏúºÎ°ú Ï†ÑÌôòÌï† TLF ÌÖåÏù¥Î∏îÎì§ ÏûÖÎãàÎã§. (Ìï¥Îãπ 21ÏùºÎ∂Ñ)[0m'
         echo '------------------------------'

         tail -21 $TOOL/tmp/droptab.sql > $TOOL/tmp/droptab.tmp
         mv $TOOL/tmp/droptab.tmp $TOOL/tmp/droptab.sql
         cat $TOOL/tmp/droptab.sql

         echo '------------------------------'
         echo
         echo 'Ï†ÑÌôòÌï†ÍπåÏöî? \c'
         read yn


         if [ $yn = 'y' ]
         then

            for g in `cat $TOOL/tmp/droptab.sql`
            do
               # ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ Ï†ÑÏö© tableÏùÑ ÏûëÏóÖÏóêÏÑú Ï†úÏô∏ (List Ï§ëÏóêÏÑú)
               if [ `ds $g | grep data500dbs | wc -l` -gt 0 ]
               then

                  # ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ Ï†ÑÏö© table ÏÉùÏÑ±
                  if [ -f $TOOL/tmp/theclient.sql ]; then rm $TOOL/tmp/theclient.sql; fi
                  ds $g | sed -e '/^$/,$d' -e 's/data500dbs  extent size 500000 next size 500000/data10dbs  extent size 10000 next size 10000/g' -e 's/'$g'/new_'$g'/g' > $TOOL/tmp/theclient.sql
                  dbaccess dbname $TOOL/tmp/theclient.sql
                  if [ -f $TOOL/tmp/theclient.sql ]; then rm $TOOL/tmp/theclient.sql; fi

                  # ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ Ï†ÑÏö© TableÎ°ú ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ TLFÎßå Ïù¥Í¥Ä
                  $TOOL/bin/dbcopy -f 10000 -l $g.err -h $INFORMIXSERVER -H $INFORMIXSERVER -d dbname -D dbname -t $g -T new_$g -s "select * from $g where tax_pers_numb [1,3] in ($TAX_PERS_NUMB)"

                  # ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ Ï†ÑÏö© TableÏóê Index ÏÉùÏÑ±
                  ds $g | sed -e '1,/revoke/d' -e 's/'$g'/new_'$g'/g' > $TOOL/tmp/theclient.sql
                  dbaccess dbname $TOOL/tmp/theclient.sql
                  if [ -f $TOOL/tmp/theclient.sql ]; then rm $TOOL/tmp/theclient.sql; fi

                  # ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ Ï†ÑÏö© Table ÌÜµÍ≥ÑÏ†ïÎ≥¥ Í∞±Ïã†
                  dbaccess dbname<<!
                     update statistics high for table new_$g;
!
                  # ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ Ï†ÑÏö© TableÏùÑ cctlhÎ°ú Rename
                  ds $g | grep "create" | sed -e "s/unique//g" -e "s/\"[A-z]*\".//g" | $CAWK -F ' ' '{ printf("rename %s %s to old_%s;\n", $2, $3, $3); }' > $TOOL/tmp/theclient.sql
                  ds $g | grep "create" | sed -e "s/unique//g" -e "s/\"[A-z]*\".//g" | $CAWK -F ' ' '{ printf("rename %s new_%s to %s;\n", $2, $3, $3); }' >> $TOOL/tmp/theclient.sql
                  dbaccess dbname $TOOL/tmp/theclient.sql

                  chkext $g
               else
                  echo $g'Îäî ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ Ï†ÑÏö© Table ÏûÖÎãàÎã§.'
               fi
            done

            echo 'Î∞òÎìúÏãú old_cctlhyymmddÎ•º ÏßÄÏö∞ÏÑ∏Ïöî'
            echo 'n' | tablst2 old_cctlh
            echo

            if [ -f $TOOL/tmp/theclient.sql ]; then rm $TOOL/tmp/theclient.sql; fi

         else
            echo 'Í∑∏ÎÉ• Îë°ÎãàÎã§'
         fi

      #############################
      #   Table ÏÇ≠Ï†ú
      #############################       
      else  
               
         echo  
         echo 'Ïò§ÎäòÏùÄ '`date +"$ymd"`
         echo '------------------------------'
         echo '[5mÏßÄÏö∞Î†§Í≥† ÌïòÎäî ÌÖåÏù¥Î∏îÎì§ ÏûÖÎãàÎã§.[0m'
         echo '------------------------------'
                  
         cat $TOOL/tmp/droptab.sql
                  
         echo '------------------------------'
         echo
         echo 'ÏßÄÏö∏ÍπåÏöî? \c'
         read yn  

         if [ $yn = 'y' ]
         then     
                  
            echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
            echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

            dbaccess dbname $TOOL/tmp/droptab.sql 
                  
         else        
            echo 'Í∑∏ÎÉ• Îë°ÎãàÎã§'
         fi
                  
      fi          


   elif [ $yn -eq 2 ]; then 

      echo        
      echo '----------------------------------------'
      echo ' <PBÏóÖÎ¨¥Í≥Ñ> ÏÇ≠Ï†úÌï† ÌÖåÏù¥Î∏î Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.'
      echo '----------------------------------------'
      echo '   [5m1) Í∏∞Í∞ÑÎßåÎ£å 3Îã¨ (Îã®ÎßêÏßëÍ≥ÑÏù¥Î†•)[0m'
      echo '   2) Î∞±ÏóÖÏôÑÎ£å 3Îã¨ (Í≥µÏù∏Ïù∏Ï¶ùMPI)'
      echo '   3) Î∞±ÏóÖÏôÑÎ£å 6Îã¨ (PGÏõîÌÖåÏù¥Î∏î)'
      echo '   4) Î∞±ÏóÖÏôÑÎ£å 1ÎÖÑ (PGÌòÑÍ∏àÏòÅÏàòÏ¶ù)'
      if [ $INFORMIXSERVER = 'pbsec01_tcp' ] || [ $INFORMIXSERVER = 'pbtst01_tcp' ]; then
         echo '   [5m5) Í∏∞Í∞ÑÎßåÎ£å 6Îã¨ (Î™®ÎãàÌÑ∞ÎßÅ Îì±)[0m'
      fi    
      echo '----------------------------------------'
      echo ' >> \c'
      read yn

      if [ $yn = "1" ];   then export period=3 ; export bu=''
      elif [ $yn = "2" ]; then export period=3; export bu='b'
      elif [ $yn = "3" ]; then export period=6; export bu='b'
      elif [ $yn = "4" ]; then export period=12; export bu='b'
      elif [ $yn = "5" ]; then export period=6; export bu='m'
      else exit
      fi

      if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
      if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

      dbaccess dbname<<! 1> /dev/null 2> /dev/null
         set isolation to dirty read;
         unload to $TOOL/tmp/droptab.tmp delimiter ' '
         select first 1 to_char( today - interval(`expr $period + $minus`) month to month, "%y%m" ) tabdate from dual;
!

      export themonth=`cat $TOOL/tmp/droptab.tmp`

      if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

      for i in `cat ~informix/SCHEMA/tables_m_$period$bu`
      do
         dbaccess dbname<<! 1> /dev/null 2> /dev/null
            set isolation to dirty read;
            unload to $TOOL/tmp/droptab.tmp delimiter ' '
            select tabname from systables
             where tabid > 99 and tabtype='T'
               and tabname like '$i%'
               and tabname < '$i$themonth'
               and length(tabname) = length('$i$themonth')
               and tabname != '${i}yymm';
!
         cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
         if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
      done

      echo
      echo 'Ïò§ÎäòÏùÄ '`date +"$ymd"`
      echo '------------------------------'
      echo '[5mÏßÄÏö∞Î†§Í≥† ÌïòÎäî ÌÖåÏù¥Î∏îÎì§ ÏûÖÎãàÎã§.[0m'
      echo '------------------------------'

      cat $TOOL/tmp/droptab.sql

      echo '------------------------------'
      echo
      echo 'ÏßÄÏö∏ÍπåÏöî? \c'
      read yn


      if [ $yn = 'y' ]
      then

         echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
         echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

         dbaccess dbname $TOOL/tmp/droptab.sql

      else
         echo 'Í∑∏ÎÉ• Îë°ÎãàÎã§'
      fi

   elif [ $yn -eq 0 ]; then

      echo
      echo 'Îπ†Ïù¥Îπ†Ïù¥...Goodbye ~~~~ ^oo^'
      exit

   else

      echo
      echo 'ÏûòÎ™ª ÏûÖÎ†• ÌïòÏÖ®ÏäµÎãàÎã§.'
      exit

   fi


###########################################
#   Ï†ïÎ≥¥Í≥Ñ
###########################################

elif [ $INFORMIXSERVER = 'svr_tcp' ] || [ $INFORMIXSERVER = 'tst_tcp' ]
then 
	
	echo
	echo '<< Ï†ïÎ≥¥Í≥Ñ >>'
	echo '-------------------------------------------'
	echo '     ÏÇ≠Ï†úÌï† ÌÖåÏù¥Î∏îÏùò Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî'
	echo '-------------------------------------------'
	echo '     1) Ïùº Ï£ºÍ∏∞ ÌÖåÏù¥Î∏î'
	echo '     2) Ïõî Ï£ºÍ∏∞ ÌÖåÏù¥Î∏î'
	echo '     0) Îπ†Ï†∏ ÎÇòÍ∞ÄÍ∏∞'
	echo '-------------------------------------------'
	echo '     > \c'
	read yn
	echo

	if [ $yn -eq 1 ]; then

		echo
		echo '----------------------------------------'
		echo '   ÏÇ≠Ï†úÌï† ÌÖåÏù¥Î∏î Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.'
		echo '----------------------------------------'
		echo '   [5m1) Í∏∞Í∞ÑÎßåÎ£å 1Ï£ºÏùº  (ÏßÄÏó∞Ï≤òÎ¶¨ Îì±)[0m'
		echo '   [5m2) Í∏∞Í∞ÑÎßåÎ£å ÌïúÎã¨   (DDC,EDI Îì±)[0m'
		echo '   3) Î∞±ÏóÖÏôÑÎ£å 1Ï£ºÏùº  (ÎåÄÌñâÏäπÏù∏ Îì±)'
		echo '   4) Î∞±ÏóÖÏôÑÎ£å ÌïúÎã¨   (PDI Îì±)'
		echo '   5) Î∞±ÏóÖÏôÑÎ£å ÎëêÎã¨   (Î∞∞ÏπòÏäπÏù∏ Îì±)'
		echo '   6) Î∞±ÏóÖÏôÑÎ£å Ïó¨ÏÑØÎã¨ (Ï∑®ÏÜåÎÇ¥Ïó≠ Îì±)'
		echo '----------------------------------------'
		echo ' >> \c'
		read yn

		if [ $yn = "1" ];   then export period=7 ; export bu=''
		elif [ $yn = "2" ]; then export period=31; export bu=''
		elif [ $yn = "3" ]; then export period=7; export bu='b'
		elif [ $yn = "4" ]; then export period=31 ; export bu='b'
		elif [ $yn = "5" ]; then export period=62; export bu='b'
		elif [ $yn = "6" ]; then export period=184; export bu='b'
		else exit
		fi

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

		dbaccess dbname<<! 1> /dev/null 2> /dev/null
			set isolation to dirty read;
			unload to $TOOL/tmp/droptab.tmp delimiter ' '
			select first 1 to_char( today - $period - $minus, "%Y%m%d" ) tabdate from dual;
!

		export dday=`cat $TOOL/tmp/droptab.tmp`

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

		for i in `cat ~informix/SCHEMA/tables_d_$period$bu`
		do
			dbaccess dbname<<! 1> /dev/null 2> /dev/null
				set isolation to dirty read;
				unload to $TOOL/tmp/droptab.tmp delimiter ' '
				select tabname from systables
				 where tabid > 99 and tabtype='T'
				   and tabname like '$i%'
				   and tabname < '$i$dday'
				   and length(tabname) = length('$i$dday')
				   and tabname != '${i}yyyymmdd';
!
			cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
			if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		done

		echo
		echo 'Ïò§ÎäòÏùÄ '`date +"$ymd"`
		echo '------------------------------'
		echo '[5mÏßÄÏö∞Î†§Í≥† ÌïòÎäî ÌÖåÏù¥Î∏îÎì§ ÏûÖÎãàÎã§.[0m'
		echo '------------------------------'

		cat $TOOL/tmp/droptab.sql

		echo '------------------------------'
		echo
		echo 'ÏßÄÏö∏ÍπåÏöî? \c'
		read yn

		if [ $yn = 'y' ]
		then 

			echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
			echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

			dbaccess dbname $TOOL/tmp/droptab.sql 

		else
			echo 'Í∑∏ÎÉ• Îë°ÎãàÎã§'
		fi

	elif [ $yn -eq 2 ]; then 

		echo
		echo '----------------------------------------'
		echo '   ÏÇ≠Ï†úÌï† ÌÖåÏù¥Î∏î Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.'
		echo '----------------------------------------'
		echo '   [5m1) Í∏∞Í∞ÑÎßåÎ£å ÎëêÎã¨   (ÎßàÏù¥Ïû•Î∂Ä Îì±)[0m'
		echo '   [5m2) Í∏∞Í∞ÑÎßåÎ£å ÎëêÎã¨   (Î≤ïÏù∏Ïπ¥Îìú Îì±)[0m'
		echo '   [5m3) Í∏∞Í∞ÑÎßåÎ£å Ïó¨ÏÑØÎã¨ (Okgiro Îì±)[0m'
		echo '   4) Î∞±ÏóÖÏôÑÎ£å Ïó¨ÏÑØÎã¨ (TLF,DDC Îì±)'
		echo '   5) Î∞±ÏóÖÏôÑÎ£å ÏùºÎÖÑ   (salemoney)'
		echo '   6) Î∞±ÏóÖÏôÑÎ£å Ïù¥ÎÖÑ   (Í∞ïÌò∏Ïàò Îì±)'
		echo '   7) Î∞±ÏóÖÏôÑÎ£å ÏÇºÎÖÑ   (Î∂ÄÍ∞ÄÏÑ∏ Îì±)'
		echo '   8) Î∞±ÏóÖÏôÑÎ£å Ïò§ÎÖÑ   (Ï†ÑÌëúÏßëÍ≥Ñ Îì±)'
		echo '----------------------------------------'
		echo ' >> \c'
		read yn

		if   [ $yn = "1" ]; then export period=2 ; export bu=''
		elif [ $yn = "2" ]; then export period=5 ; export bu=''
		elif [ $yn = "3" ]; then export period=6 ; export bu=''
		elif [ $yn = "4" ]; then export period=6 ; export bu='b'
		elif [ $yn = "5" ]; then export period=12; export bu='b'
		elif [ $yn = "6" ]; then export period=24; export bu='b'
		elif [ $yn = "7" ]; then export period=36; export bu='b'
		elif [ $yn = "8" ]; then export period=60; export bu='b'
		else exit
		fi

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

		dbaccess dbname<<! 1> /dev/null 2> /dev/null
			set isolation to dirty read;
			unload to $TOOL/tmp/droptab.tmp delimiter ' '
			select first 1 to_char( today - interval(`expr $period + $minus`) month to month, "%Y%m" ) tabdate from dual;
!

		export themonth=`cat $TOOL/tmp/droptab.tmp`

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

		for i in `cat ~informix/SCHEMA/tables_m_$period$bu`
		do
			dbaccess dbname<<! 1> /dev/null 2> /dev/null
				set isolation to dirty read;
				unload to $TOOL/tmp/droptab.tmp delimiter ' '
				select tabname from systables
				 where tabid > 99 and tabtype='T'
				   and tabname like '$i%'
				   and tabname < '$i$themonth'
				   and length(tabname) = length('$i$themonth')
				   and tabname != '${i}yyyymm';
!
			cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
			if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		done

		echo
		echo 'Ïò§ÎäòÏùÄ '`date +"$ymd"`
		echo '------------------------------'
		echo '[5mÏßÄÏö∞Î†§Í≥† ÌïòÎäî ÌÖåÏù¥Î∏îÎì§ ÏûÖÎãàÎã§.[0m'
		echo '------------------------------'

		cat $TOOL/tmp/droptab.sql

		echo '------------------------------'
		echo
		echo 'ÏßÄÏö∏ÍπåÏöî? \c'
		read yn

		if [ $yn = 'y' ]
		then 

			echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
			echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

			dbaccess dbname $TOOL/tmp/droptab.sql 

		else
			echo 'Í∑∏ÎÉ• Îë°ÎãàÎã§'
		fi

	elif [ $yn -eq 0 ]; then 

		echo
		echo 'Îπ†Ïù¥Îπ†Ïù¥'
		exit

	else

		echo
		echo 'ÏûòÎ™ª ÏûÖÎ†• ÌïòÏÖ®ÏäµÎãàÎã§.'
		exit

	fi
	

###########################################
#   ÏóÖÎ¨¥Í≥Ñ
###########################################

elif [ $INFORMIXSERVER = 'mst01_tcp' ] || [ $INFORMIXSERVER = 'oldsos' ] || [ $INFORMIXSERVER = 'neoecs' ] || [ $INFORMIXSERVER = 'tst_tcp' ]; then

	echo
	echo '<< ÏóÖÎ¨¥Í≥Ñ >>'
	echo '-------------------------------------------'
	echo '     ÏÇ≠Ï†úÌï† ÌÖåÏù¥Î∏îÏùò Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî'
	echo '-------------------------------------------'
	echo '     1) Ïùº Ï£ºÍ∏∞ ÌÖåÏù¥Î∏î'
	echo '     2) Ïõî Ï£ºÍ∏∞ ÌÖåÏù¥Î∏î'
	echo '     0) Îπ†Ï†∏ ÎÇòÍ∞ÄÍ∏∞'
	echo '-------------------------------------------'
	echo '     > \c'
	read yn
	echo

	if [ $yn -eq 1 ]; then

		echo
		echo '----------------------------------------'
		echo '   ÏÇ≠Ï†úÌï† ÌÖåÏù¥Î∏î Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.'
		echo '----------------------------------------'
		echo '   [5m1) Í∏∞Í∞ÑÎßåÎ£å 1Ï£ºÏùº (ÏßÄÏó∞Ï≤òÎ¶¨ Îì±)[0m'
		echo '   [5m2) Í∏∞Í∞ÑÎßåÎ£å ÌïúÎã¨  (Í±∞ÎûòÎÇ¥Ïó≠ Îì±)[0m'
		echo '   3) Î∞±ÏóÖÏôÑÎ£å ÌïúÎã¨  (ÏßÅÎ∂à,Íµ¨Îß§ Îì±)'
		echo '   4) Î∞±ÏóÖÏôÑÎ£å ÏÑùÎã¨  (Ìè¨Ïù∏Ìä∏ Îì±)'
		echo '   5) Î∞±ÏóÖÏôÑÎ£å 12Í∞úÏõî (Í∞ÄÎßπÏ†ê Í±∞ÎûòÍ≥†Ïú†Î≤àÌò∏ Îì±)'
		echo '   6) Î∞±ÏóÖÏôÑÎ£å 24Í∞úÏõî (ÏäπÏù∏ Îì±)'
		echo '   7) TLF ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ Ï†ÑÏö©ÏúºÎ°ú Ï†ÑÌôò 3Í∞úÏõî'
		if [ $INFORMIXSERVER = 'oldsos' ] || [ $INFORMIXSERVER = 'neoecs' ]; then
			echo '   [5m8) Í∏∞Í∞ÑÎßåÎ£å 1Ï£ºÏùº (Î™®ÎãàÌÑ∞ÎßÅ Îì±)[0m'
		fi
		echo '----------------------------------------'
		echo ' >> \c'
		read yn

		if [ $yn = "1" ];   then export period=7 ;  export bu=''
		elif [ $yn = "2" ]; then export period=31;  export bu=''
		elif [ $yn = "3" ]; then export period=31;  export bu='b'
		elif [ $yn = "4" ]; then export period=92;  export bu='b'
		elif [ $yn = "5" ]; then export period=366; export bu='b'
		elif [ $yn = "6" ]; then export period=730; export bu='b'
		elif [ $yn = "7" ]; then export period=92;  export bu='g'
		elif [ $yn = "8" ]; then export period=7;   export bu='m'
		else exit
		fi

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

		dbaccess dbname<<! 1> /dev/null 2> /dev/null
			set isolation to dirty read;
			unload to $TOOL/tmp/droptab.tmp delimiter ' '
			select first 1 to_char( today - $period - $minus, "%y%m%d" ) tabdate from dual;
!

		export dday=`cat $TOOL/tmp/droptab.tmp`

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

		for i in `cat ~informix/SCHEMA/tables_d_$period$bu`
		do
			dbaccess dbname<<! 1> /dev/null 2> /dev/null
				set isolation to dirty read;
				unload to $TOOL/tmp/droptab.tmp delimiter ' '
				select tabname from systables
				 where tabid > 99 and tabtype='T'
				   and tabname like '$i%'
				   and tabname < '$i$dday'
				   and length(tabname) = length('$i$dday')
				   and tabname != '${i}yymmdd';
!
			cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
			if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		done
		
		#############################
		#   TLFÎ•º ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨Ïö©ÏúºÎ°ú Ï†ÑÌôò
		#############################
		if [ x$bu = 'xg' ]; then

			echo
			echo 'Ïò§ÎäòÏùÄ '`date +"$ymd"`
			echo '------------------------------'
			echo '[5mÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ Ï†ÑÏö©ÏúºÎ°ú Ï†ÑÌôòÌï† TLF ÌÖåÏù¥Î∏îÎì§ ÏûÖÎãàÎã§. (Ìï¥Îãπ 21ÏùºÎ∂Ñ)[0m'
			echo '------------------------------'

			tail -21 $TOOL/tmp/droptab.sql > $TOOL/tmp/droptab.tmp
			mv $TOOL/tmp/droptab.tmp $TOOL/tmp/droptab.sql
			cat $TOOL/tmp/droptab.sql

			echo '------------------------------'
			echo
			echo 'Ï†ÑÌôòÌï†ÍπåÏöî? \c'
			read yn

			if [ $yn = 'y' ]
			then 

				for g in `cat $TOOL/tmp/droptab.sql`
				do
					# ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ Ï†ÑÏö© tableÏùÑ ÏûëÏóÖÏóêÏÑú Ï†úÏô∏ (List Ï§ëÏóêÏÑú)
					if [ `ds $g | grep data500dbs | wc -l` -gt 0 ]
					then
					
						# ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ Ï†ÑÏö© table ÏÉùÏÑ±
						if [ -f $TOOL/tmp/theclient.sql ]; then rm $TOOL/tmp/theclient.sql; fi
						ds $g | sed -e '/^$/,$d' -e 's/data500dbs  extent size 500000 next size 500000/data10dbs  extent size 10000 next size 10000/g' -e 's/'$g'/new_'$g'/g' > $TOOL/tmp/theclient.sql
						dbaccess dbname $TOOL/tmp/theclient.sql
						if [ -f $TOOL/tmp/theclient.sql ]; then rm $TOOL/tmp/theclient.sql; fi
						
						# ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ Ï†ÑÏö© TableÎ°ú ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ TLFÎßå Ïù¥Í¥Ä
						$TOOL/bin/dbcopy -f 10000 -l $g.err -h $INFORMIXSERVER -H $INFORMIXSERVER -d dbname -D dbname -t $g -T new_$g -s "select * from $g where tax_pers_numb [1,3] in ($TAX_PERS_NUMB)"
					
						# ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ Ï†ÑÏö© TableÏóê Index ÏÉùÏÑ±
						ds $g | sed -e '1,/revoke/d' -e 's/'$g'/new_'$g'/g' > $TOOL/tmp/theclient.sql
						dbaccess dbname $TOOL/tmp/theclient.sql
						if [ -f $TOOL/tmp/theclient.sql ]; then rm $TOOL/tmp/theclient.sql; fi
							
						# ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ Ï†ÑÏö© Table ÌÜµÍ≥ÑÏ†ïÎ≥¥ Í∞±Ïã†
						dbaccess dbname<<!
							update statistics high for table new_$g;
!
					
						# ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ Ï†ÑÏö© TableÏùÑ cctlhÎ°ú Rename
						ds $g | grep "create" | sed -e "s/unique//g" -e "s/\"[A-z]*\".//g" | $CAWK -F ' ' '{ printf("rename %s %s to old_%s;\n", $2, $3, $3); }' > $TOOL/tmp/theclient.sql
						ds $g | grep "create" | sed -e "s/unique//g" -e "s/\"[A-z]*\".//g" | $CAWK -F ' ' '{ printf("rename %s new_%s to %s;\n", $2, $3, $3); }' >> $TOOL/tmp/theclient.sql
						dbaccess dbname $TOOL/tmp/theclient.sql
						
						chkext $g
					else
						echo $g'Îäî ÌäπÏ†ïÍ≥†Í∞ùÏÇ¨ Ï†ÑÏö© Table ÏûÖÎãàÎã§.'
					fi
				done
				
				echo 'Î∞òÎìúÏãú old_cctlhyymmddÎ•º ÏßÄÏö∞ÏÑ∏Ïöî'
				echo 'n' | tablst2 old_cctlh
				echo
				
				if [ -f $TOOL/tmp/theclient.sql ]; then rm $TOOL/tmp/theclient.sql; fi

			else
				echo 'Í∑∏ÎÉ• Îë°ÎãàÎã§'
			fi

		#############################
		#   Table ÏÇ≠Ï†ú
		#############################			
		else

			echo
			echo 'Ïò§ÎäòÏùÄ '`date +"$ymd"`
			echo '------------------------------'
			echo '[5mÏßÄÏö∞Î†§Í≥† ÌïòÎäî ÌÖåÏù¥Î∏îÎì§ ÏûÖÎãàÎã§.[0m'
			echo '------------------------------'

			cat $TOOL/tmp/droptab.sql

			echo '------------------------------'
			echo
			echo 'ÏßÄÏö∏ÍπåÏöî? \c'
			read yn

			if [ $yn = 'y' ]
			then 

				echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
				echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

				dbaccess dbname $TOOL/tmp/droptab.sql 

			else
				echo 'Í∑∏ÎÉ• Îë°ÎãàÎã§'
			fi
						
		fi

	elif [ $yn -eq 2 ]; then 

		echo
		echo '----------------------------------------'
		echo '   ÏÇ≠Ï†úÌï† ÌÖåÏù¥Î∏î Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.'
		echo '----------------------------------------'
		echo '   [5m1) Í∏∞Í∞ÑÎßåÎ£å 3Îã¨ (Îã®ÎßêÏßëÍ≥ÑÏù¥Î†•)[0m'
		echo '   2) Î∞±ÏóÖÏôÑÎ£å 3Îã¨ (Í≥µÏù∏Ïù∏Ï¶ùMPI)'
		echo '   3) Î∞±ÏóÖÏôÑÎ£å 6Îã¨ (PGÏõîÌÖåÏù¥Î∏î)'
		echo '   4) Î∞±ÏóÖÏôÑÎ£å 1ÎÖÑ (PGÌòÑÍ∏àÏòÅÏàòÏ¶ù)'
		if [ $INFORMIXSERVER = 'oldsos' ] || [ $INFORMIXSERVER = 'neoecs' ]; then
			echo '   [5m5) Í∏∞Í∞ÑÎßåÎ£å 6Îã¨ (Î™®ÎãàÌÑ∞ÎßÅ Îì±)[0m'
		fi
		echo '----------------------------------------'
		echo ' >> \c'
		read yn

		if [ $yn = "1" ];   then export period=3 ; export bu=''
		elif [ $yn = "2" ]; then export period=3; export bu='b'
		elif [ $yn = "3" ]; then export period=6; export bu='b'
		elif [ $yn = "4" ]; then export period=12; export bu='b'
		elif [ $yn = "5" ]; then export period=6; export bu='m'
		else exit
		fi

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

		dbaccess dbname<<! 1> /dev/null 2> /dev/null
			set isolation to dirty read;
			unload to $TOOL/tmp/droptab.tmp delimiter ' '
			select first 1 to_char( today - interval(`expr $period + $minus`) month to month, "%y%m" ) tabdate from dual;
!

		export themonth=`cat $TOOL/tmp/droptab.tmp`

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

		for i in `cat ~informix/SCHEMA/tables_m_$period$bu`
		do
			dbaccess dbname<<! 1> /dev/null 2> /dev/null
				set isolation to dirty read;
				unload to $TOOL/tmp/droptab.tmp delimiter ' '
				select tabname from systables
				 where tabid > 99 and tabtype='T'
				   and tabname like '$i%'
				   and tabname < '$i$themonth'
				   and length(tabname) = length('$i$themonth')
				   and tabname != '${i}yymm';
!
			cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
			if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		done

		echo
		echo 'Ïò§ÎäòÏùÄ '`date +"$ymd"`
		echo '------------------------------'
		echo '[5mÏßÄÏö∞Î†§Í≥† ÌïòÎäî ÌÖåÏù¥Î∏îÎì§ ÏûÖÎãàÎã§.[0m'
		echo '------------------------------'

		cat $TOOL/tmp/droptab.sql

		echo '------------------------------'
		echo
		echo 'ÏßÄÏö∏ÍπåÏöî? \c'
		read yn

		if [ $yn = 'y' ]
		then 

			echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
			echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

			dbaccess dbname $TOOL/tmp/droptab.sql 

		else
			echo 'Í∑∏ÎÉ• Îë°ÎãàÎã§'
		fi

	elif [ $yn -eq 0 ]; then 

		echo
		echo 'Îπ†Ïù¥Îπ†Ïù¥'
		exit

	else

		echo
		echo 'ÏûòÎ™ª ÏûÖÎ†• ÌïòÏÖ®ÏäµÎãàÎã§.'
		exit

	fi



###########################################
#   Ï†ïÎ≥¥Í≥Ñ Ï†ú2ÏÑúÎ≤Ñ(Ï†ÑÏûêÏÑúÎ™Ö DB)
###########################################

elif [ $INFORMIXSERVER = 'desc01_tcp' ]
then

   echo
   echo '<< Ï†ÑÏûêÏÑúÎ™Ö DB >>'
   echo '-------------------------------------------'
   echo '     ÏÇ≠Ï†úÌï† ÌÖåÏù¥Î∏îÏùò Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî'
   echo '-------------------------------------------'
   echo '     1) Ïùº Ï£ºÍ∏∞ ÌÖåÏù¥Î∏î'
   echo '     2) Ïõî Ï£ºÍ∏∞ ÌÖåÏù¥Î∏î'
   echo '     0) Îπ†Ï†∏ ÎÇòÍ∞ÄÍ∏∞'
   echo '-------------------------------------------'
   echo '     > \c'
   read yn
   echo

    if [ $yn -eq 1 ]; then

        echo
        echo '----------------------------------------'
        echo '   ÏÇ≠Ï†úÌï† ÌÖåÏù¥Î∏î Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.'
        echo '----------------------------------------'
        echo '   4) Î∞±ÏóÖÏôÑÎ£å ÌïúÎã¨   (signrtlh,descÎì±)'
        echo '----------------------------------------'
        echo ' >> \c'
        read yn


        if [ $yn = "1" ];   then export period=7 ; export bu=''
        elif [ $yn = "2" ]; then export period=31; export bu=''
        elif [ $yn = "3" ]; then export period=7; export bu='b'
        elif [ $yn = "4" ]; then export period=31 ; export bu='b'
        elif [ $yn = "5" ]; then export period=62; export bu='b'
        elif [ $yn = "6" ]; then export period=184; export bu='b'
        else exit
        fi

        if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
        if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

        dbaccess dbname<<! 1> /dev/null 2> /dev/null
            set isolation to dirty read;
            unload to $TOOL/tmp/droptab.tmp delimiter ' '
            select first 1 to_char( today - $period - $minus, "%Y%m%d" ) tabdate from dual;
!

        export dday=`cat $TOOL/tmp/droptab.tmp`

        if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

        for i in `cat ~informix/SCHEMA/DESC/tables_d_$period$bu`
        do
            dbaccess dbname<<! 1> /dev/null 2> /dev/null
                set isolation to dirty read;
                unload to $TOOL/tmp/droptab.tmp delimiter ' '
                select tabname from systables
                 where tabid > 99 and tabtype='T'
                   and tabname like '$i%'
                   and tabname < '$i$dday'
                   and length(tabname) = length('$i$dday')
                   and tabname != '${i}yyyymmdd';
!

            cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
            if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
        done

        echo
        echo 'Ïò§ÎäòÏùÄ '`date +"$ymd"`
        echo '------------------------------'
        echo '[5mÏßÄÏö∞Î†§Í≥† ÌïòÎäî ÌÖåÏù¥Î∏îÎì§ ÏûÖÎãàÎã§.[0m'
        echo '------------------------------'

        cat $TOOL/tmp/droptab.sql

        echo '------------------------------'
        echo
        echo 'ÏßÄÏö∏ÍπåÏöî? \c'
        read yn

        if [ $yn = 'y' ]
        then

            echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
            echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

            dbaccess dbname $TOOL/tmp/droptab.sql

        else
            echo 'Í∑∏ÎÉ• Îë°ÎãàÎã§'
        fi


    elif [ $yn -eq 2 ]; then

        echo
        echo '----------------------------------------'
        echo '   ÏÇ≠Ï†úÌï† ÌÖåÏù¥Î∏î Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.'
        echo '----------------------------------------'
       # echo '   [5m1) Í∏∞Í∞ÑÎßåÎ£å ÎëêÎã¨   (ÎßàÏù¥Ïû•Î∂Ä Îì±)[0m'
       # echo '   [5m2) Í∏∞Í∞ÑÎßåÎ£å ÎëêÎã¨   (Î≤ïÏù∏Ïπ¥Îìú Îì±)[0m'
       # echo '   3) Î∞±ÏóÖÏôÑÎ£å Ïó¨ÏÑØÎã¨ (TLF,DDC Îì±)'
       # echo '   4) Î∞±ÏóÖÏôÑÎ£å ÏùºÎÖÑ   (salemoney)'
       # echo '   5) Î∞±ÏóÖÏôÑÎ£å Ïù¥ÎÖÑ   (Í∞ïÌò∏Ïàò Îì±)'
       # echo '   6) Î∞±ÏóÖÏôÑÎ£å ÏÇºÎÖÑ   (Î∂ÄÍ∞ÄÏÑ∏ Îì±)'
       # echo '   7) Î∞±ÏóÖÏôÑÎ£å Ïò§ÎÖÑ   (Ï†ÑÌëúÏßëÍ≥Ñ Îì±)'
        echo '   97) Ìï¥ÎãπÏÇ¨Ìï≠ ÏóÜÏùå. '
        echo '----------------------------------------'
        echo ' >> \c'
        read yn


        if   [ $yn = "1" ]; then export period=2 ; export bu=''
        elif [ $yn = "2" ]; then export period=5 ; export bu=''
        elif [ $yn = "3" ]; then export period=6 ; export bu='b'
        elif [ $yn = "4" ]; then export period=12; export bu='b'
        elif [ $yn = "5" ]; then export period=24; export bu='b'
        elif [ $yn = "6" ]; then export period=36; export bu='b'
        elif [ $yn = "7" ]; then export period=60; export bu='b'
        else exit
        fi

        if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
        if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi


        dbaccess dbname<<! 1> /dev/null 2> /dev/null
            set isolation to dirty read;
            unload to $TOOL/tmp/droptab.tmp delimiter ' '
            select first 1 to_char( today - interval(`expr $period + $minus`) month to month, "%Y%m" ) tabdate from dual;
!

        export themonth=`cat $TOOL/tmp/droptab.tmp`

        if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

        for i in `cat ~informix/SCHEMA/DESC/tables_m_$period$bu`
        do
            dbaccess dbname<<! 1> /dev/null 2> /dev/null
                set isolation to dirty read;
                unload to $TOOL/tmp/droptab.tmp delimiter ' '
                select tabname from systables
                 where tabid > 99 and tabtype='T'
                   and tabname like '$i%'
                   and tabname < '$i$themonth'
                   and length(tabname) = length('$i$themonth')
                   and tabname != '${i}yyyymm';
!
            cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
            if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
        done

        echo
        echo 'Ïò§ÎäòÏùÄ '`date +"$ymd"`
        echo '------------------------------'
        echo '[5mÏßÄÏö∞Î†§Í≥† ÌïòÎäî ÌÖåÏù¥Î∏îÎì§ ÏûÖÎãàÎã§.[0m'
        echo '------------------------------'

        cat $TOOL/tmp/droptab.sql

        echo '------------------------------'
        echo
        echo 'ÏßÄÏö∏ÍπåÏöî? \c'
        read yn

        if [ $yn = 'y' ]
        then
            echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
            echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

            dbaccess dbname $TOOL/tmp/droptab.sql

        else
            echo 'Í∑∏ÎÉ• Îë°ÎãàÎã§'
        fi

    elif [ $yn -eq 0 ]; then

        echo
        echo 'Îπ†Ïù¥Îπ†Ïù¥'
        exit

    else

        echo
        echo 'ÏûòÎ™ª ÏûÖÎ†• ÌïòÏÖ®ÏäµÎãàÎã§.'
        exit

    fi


###########################################
#   Ï†ïÎ≥¥Í≥Ñ Ï†ú2ÏÑúÎ≤Ñ
###########################################

elif [ $INFORMIXSERVER = 'mst03_tcp' ]
then 
	
	echo
	echo '<< ÎßàÏù¥Ïû•Î∂Ä >>'
	echo '-------------------------------------------'
	echo '     ÏÇ≠Ï†úÌï† ÌÖåÏù¥Î∏îÏùò Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî'
	echo '-------------------------------------------'
	echo '     2) Ïõî Ï£ºÍ∏∞ ÌÖåÏù¥Î∏î'
	echo '     0) Îπ†Ï†∏ ÎÇòÍ∞ÄÍ∏∞'
	echo '-------------------------------------------'
	echo '     > \c'
	read yn
	echo

	if [ $yn -eq 2 ]; then 

		echo
		echo '----------------------------------------'
		echo '   ÏÇ≠Ï†úÌï† ÌÖåÏù¥Î∏î Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.'
		echo '----------------------------------------'
		echo '   1) ÎßàÏù¥Ïû•Î∂Ä 2ÎÖÑ'
		echo '----------------------------------------'
		echo ' >> \c'
		read yn

		if [ $yn = "1" ];   then export period=24 ; export bu='b'
		else exit
		fi

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

		dbaccess dbname<<! 1> /dev/null 2> /dev/null
			set isolation to dirty read;
			unload to $TOOL/tmp/droptab.tmp delimiter ' '
			select first 1 to_char( today - interval(`expr $period + $minus`) month to month, "%Y%m" ) tabdate from dual;
!

		export themonth=`cat $TOOL/tmp/droptab.tmp`

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

		for i in `cat ~informix/SCHEMA/M03/tables_m_$period$bu`
		do
			dbaccess dbname<<! 1> /dev/null 2> /dev/null
				set isolation to dirty read;
				unload to $TOOL/tmp/droptab.tmp delimiter ' '
				select tabname from systables
 				 where tabid > 99 and tabtype='T'
				   and tabname like '$i%'
				   and tabname < '$i$themonth'
				   and length(tabname) = length('$i$themonth')
				   and tabname != '${i}yyyymm';
!
			cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
			if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		done

		echo
		echo 'Ïò§ÎäòÏùÄ '`date +"$ymd"`
		echo '------------------------------'
		echo '[5mÏßÄÏö∞Î†§Í≥† ÌïòÎäî ÌÖåÏù¥Î∏îÎì§ ÏûÖÎãàÎã§.[0m'
		echo '------------------------------'

		cat $TOOL/tmp/droptab.sql

		echo '------------------------------'
		echo
		echo 'ÏßÄÏö∏ÍπåÏöî? \c'
		read yn

		if [ $yn = 'y' ]
		then 

			echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
			echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

			dbaccess dbname $TOOL/tmp/droptab.sql 

		else
			echo 'Í∑∏ÎÉ• Îë°ÎãàÎã§'
		fi

	elif [ $yn -eq 0 ]; then 

		echo
		echo 'Îπ†Ïù¥Îπ†Ïù¥'
		exit

	else

		echo
		echo 'ÏûòÎ™ª ÏûÖÎ†• ÌïòÏÖ®ÏäµÎãàÎã§.'
		exit

	fi


###########################################
#   Ïã† ÎßàÏù¥Ïû•Î∂Ä
###########################################

elif [ $INFORMIXSERVER = 'henry_tcp' ]
then 

	# Ïã† ÎßàÏù¥Ïû•Î∂Ä Ïù¥Í¥Ä Ï§ëÏù¥ÎØÄÎ°ú Block ######
	echo 'ÏßÄÏö∞ÏßÄ ÎßàÏÑ∏Ïöî'
	exit
	########################################
	
	echo
	echo '<< Ïã† ÎßàÏù¥Ïû•Î∂Ä >>'
	echo '-------------------------------------------'
	echo '     ÏÇ≠Ï†úÌï† ÌÖåÏù¥Î∏îÏùò Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî'
	echo '-------------------------------------------'
	echo '     1) Ïùº Ï£ºÍ∏∞ ÌÖåÏù¥Î∏î'
	echo '     2) Ïõî Ï£ºÍ∏∞ ÌÖåÏù¥Î∏î'
	echo '     0) Îπ†Ï†∏ ÎÇòÍ∞ÄÍ∏∞'
	echo '-------------------------------------------'
	echo '     > \c'
	read yn
	echo

	if [ $yn -eq 1 ]; then

		echo
		echo '----------------------------------------'
		echo '   ÏÇ≠Ï†úÌï† ÌÖåÏù¥Î∏î Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.'
		echo '----------------------------------------'
		echo '   [5m1) Í∏∞Í∞ÑÎßåÎ£å 1Ï£ºÏùº  (ÌïòÎ™®Îãà Îì±)[0m'
		echo '   [5m2) Í∏∞Í∞ÑÎßåÎ£å 2Ï£ºÏùº  (ÌïòÎ™®Îãà TLF ÌõÑÏ≤òÎ¶¨ Îì±)[0m'
		echo '----------------------------------------'
		echo ' >> \c'
		read yn

		if [ $yn = "1" ];   then export period=7 ; export bu=''
		elif [ $yn = "2" ];   then export period=14 ; export bu=''
		else exit
		fi

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

		dbaccess dbname<<! 1> /dev/null 2> /dev/null
			set isolation to dirty read;
			unload to $TOOL/tmp/droptab.tmp delimiter ' '
			select first 1 to_char( today - $period - $minus, "%y%m%d" ) tabdate from dual;
!

		export dday=`cat $TOOL/tmp/droptab.tmp`

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

		for i in `cat ~informix/SCHEMA/tables_d_$period$bu`
		do
			dbaccess dbname<<! 1> /dev/null 2> /dev/null
				set isolation to dirty read;
				unload to $TOOL/tmp/droptab.tmp delimiter ' '
				select tabname from systables
				 where tabid > 99 and tabtype='T'
				   and tabname like '$i%'
				   and tabname < '$i$dday'
				   and length(tabname) = length('$i$dday')
				   and tabname != '${i}yyyymmdd';
!
			cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
			if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		done

		echo
		echo 'Ïò§ÎäòÏùÄ '`date +"$ymd"`
		echo '------------------------------'
		echo '[5mÏßÄÏö∞Î†§Í≥† ÌïòÎäî ÌÖåÏù¥Î∏îÎì§ ÏûÖÎãàÎã§.[0m'
		echo '------------------------------'

		cat $TOOL/tmp/droptab.sql

		echo '------------------------------'
		echo
		echo 'ÏßÄÏö∏ÍπåÏöî? \c'
		read yn

		if [ $yn = 'y' ]
		then 

			echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
			echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

			dbaccess dbname $TOOL/tmp/droptab.sql 

		else
			echo 'Í∑∏ÎÉ• Îë°ÎãàÎã§'
		fi

	elif [ $yn -eq 2 ]; then  

		echo
		echo '----------------------------------------'
		echo '   ÏÇ≠Ï†úÌï† ÌÖåÏù¥Î∏î Ïú†ÌòïÏùÑ ÏÑ†ÌÉùÌïòÏÑ∏Ïöî.'
		echo '----------------------------------------'
		echo '   [5m1) Í∏∞Í∞ÑÎßåÎ£å 6Îã¨ (TLF Îì±)[0m'
		echo '   2) Î∞±ÏóÖÏôÑÎ£å 1ÎÖÑ (Ïã† ÎßàÏù¥Ïû•Î∂Ä)'
		echo '----------------------------------------'
		echo ' >> \c'
		read yn

		if [ $yn = "1" ]; then export period=6 ; export bu=''
		elif [ $yn = "2" ]; then export period=12 ; export bu='b'
		else exit
		fi

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

		dbaccess dbname<<! 1> /dev/null 2> /dev/null
			set isolation to dirty read;
			unload to $TOOL/tmp/droptab.tmp delimiter ' '
			select first 1 to_char( today - interval(`expr $period + $minus`) month to month, "%y%m" ) tabdate from dual;
!

		export themonth=`cat $TOOL/tmp/droptab.tmp`

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

		for i in `cat ~informix/SCHEMA/tables_m_$period$bu`
		do
			dbaccess dbname<<! 1> /dev/null 2> /dev/null
				set isolation to dirty read;
				unload to $TOOL/tmp/droptab.tmp delimiter ' '
				select tabname from systables
 				 where tabid > 99 and tabtype='T'
				   and tabname like '$i%'
				   and tabname < '$i$themonth'
				   and length(tabname) = length('$i$themonth')
				   and tabname != '${i}yyyymm';
!
			cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
			if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		done

		echo
		echo 'Ïò§ÎäòÏùÄ '`date +"$ymd"`
		echo '------------------------------'
		echo '[5mÏßÄÏö∞Î†§Í≥† ÌïòÎäî ÌÖåÏù¥Î∏îÎì§ ÏûÖÎãàÎã§.[0m'
		echo '------------------------------'

		cat $TOOL/tmp/droptab.sql

		echo '------------------------------'
		echo
		echo 'ÏßÄÏö∏ÍπåÏöî? \c'
		read yn

		if [ $yn = 'y' ]
		then 

			echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
			echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

			dbaccess dbname $TOOL/tmp/droptab.sql 

		else
			echo 'Í∑∏ÎÉ• Îë°ÎãàÎã§'
		fi

	elif [ $yn -eq 0 ]; then 

		echo
		echo 'Îπ†Ïù¥Îπ†Ïù¥'
		exit

	else

		echo
		echo 'ÏûòÎ™ª ÏûÖÎ†• ÌïòÏÖ®ÏäµÎãàÎã§.'
		exit

	fi

else

	echo 'ÌôòÍ≤Ω ÏÑ§Ï†ïÏùÑ Îã§Ïãú ÌôïÏù∏ÌïòÏÑ∏Ïöî ^^'

fi

if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

done ##### Main While Loop
