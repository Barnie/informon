#!/bin/ksh

####################################################################         
# 
#   droptab : ë³´ê´€ê¸°ê°„ì´ ì§€ë‚œ Tableì„ Dropí•˜ëŠ” Shellì…ë‹ˆë‹¤
#
#   ì‘ì„±ì : ë°”ë‹ˆ                 ì‘ì„±ì¼ì : 2003ë…„  6ì›” 20ì¼
#                                 ìµœì¢…ìˆ˜ì • : 2009ë…„  6ì›” 10ì¼
#
#   ì‚¬ìš©ë²• : droptab (í˜„ì¬ì¼ì ì´ì „ ëª‡ì¼)
#   ìš”íŒŒì¼ : ds, $TOOL/bin/dbcopy
#
####################################################################

# OSë³„ awk ì„¤ì • #########################################################
if [ `uname` = 'HP-UX' ]
then
   export CAWK=awk
else
   export CAWK=nawk
fi
#########################################################################

export TOOL=$HOME/tool

# Gë§ˆì¼“ êµ¬ë¶„ ë²ˆí˜¸ (ë°˜ë“œì‹œ ì—…ë¬´ê³„ë¡œ ë°°í¬í•˜ì—¬ ì‚¬ìš©í•˜ì„¸ìš” â˜†â˜†â˜†â˜†â˜†
#export DEVI_NUMB="'DPT0Q00915','DPT0Q00918','DPT0Q00919','DPT0Q00920','DPT0Q00921','DPT0Q01256','DPT0Q01644','DPT0Q01696','DPT0Q01695','DPT0Q01734','DPT0Q02012','DPT0Q02013','DPT0Q02893','DPT0Q02894','DPT0Q02905'"
#export VAN_MEMB_NUMB="'2208183676'"
export TAX_PERS_NUMB="'EBA','GMK','INI','AUC','LGU'"

if [ ! "$1" ]
then export minus=0
else export minus=$1
fi

if [ `env | grep SCHEMADIR | wc -l` -lt 1 ]
then
	export SCHEMADIR=$INFORMIX/SCHEMA
fi 

while true
do ##### Main While Loop

###########################################
#   PBì—…ë¬´ê³„/PBë¹„ìƒìŠ¹ì¸
###########################################

if [ $INFORMIXSERVER = 'pb01_tcp' ] || [ $INFORMIXSERVER = 'pbsec01_tcp' ]
then 

   echo
   echo '<< PBì—…ë¬´ê³„ >>'
   echo '-------------------------------------------'
   echo '     ì‚­ì œí•  í…Œì´ë¸”ì˜ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”'
   echo '-------------------------------------------'
   echo '     1) ì¼ ì£¼ê¸° í…Œì´ë¸”'
   echo '     2) ì›” ì£¼ê¸° í…Œì´ë¸”'
   echo '     0) ë¹ ì ¸ ë‚˜ê°€ê¸°'
   echo '-------------------------------------------'
   echo '     > \c'
   read yn
   echo

   if [ $yn -eq 1 ]; then

      echo
      echo '----------------------------------------'
      echo '   ì‚­ì œí•  í…Œì´ë¸” ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.'
      echo '----------------------------------------'
      echo '   [5m1) ê¸°ê°„ë§Œë£Œ 1ì£¼ì¼ (ì§€ì—°ì²˜ë¦¬ ë“±)[0m'
      echo '   [5m2) ê¸°ê°„ë§Œë£Œ í•œë‹¬  (ê±°ë˜ë‚´ì—­ ë“±) - í˜„ì¬ì—†ìŒ[0m'
      echo '   3) ë°±ì—…ì™„ë£Œ í•œë‹¬  (ì§ë¶ˆ,êµ¬ë§¤ ë“±) - í˜„ì¬ì—†ìŒ'
      echo '   4) ë°±ì—…ì™„ë£Œ ì„ë‹¬  (í¬ì¸íŠ¸ ë“±) - í˜„ì¬ì—†ìŒ'
      echo '   5) ë°±ì—…ì™„ë£Œ 12ê°œì›” (ê°€ë§¹ì  ê±°ë˜ê³ ìœ ë²ˆí˜¸ ë“±) - í˜„ì¬ì—†ìŒ'
      echo '   6) ë°±ì—…ì™„ë£Œ 24ê°œì›” (ìŠ¹ì¸ ë“±) - í˜„ì¬ì—†ìŒ'
		echo '   7) TLF Gë§ˆì¼“ ì „ìš©ìœ¼ë¡œ ì „í™˜ 3ê°œì›” - í˜„ì¬ì—†ìŒ'
      if [ $INFORMIXSERVER = 'pbsec01_tcp' ] || [ $INFORMIXSERVER = 'pbtst01_tcp' ]; then
         echo '   [5m8) ê¸°ê°„ë§Œë£Œ 1ì£¼ì¼ (ëª¨ë‹ˆí„°ë§ ë“±) - í˜„ì¬ì—†ìŒ[0m'
      fi
      echo '----------------------------------------'
      echo ' >> \c'
      read yn

      if [ $yn = "1" ];   then export period=7 ;  export bu=''
      elif [ $yn = "2" ]; then export period=31;  export bu=''
      elif [ $yn = "3" ]; then export period=31;  export bu='b'
      elif [ $yn = "4" ]; then export period=92;  export bu='b'
      elif [ $yn = "5" ]; then export period=366; export bu='b'
      elif [ $yn = "6" ]; then export period=730; export bu='b'
      elif [ $yn = "7" ]; then export period=92;  export bu='g'
      elif [ $yn = "8" ]; then export period=7;   export bu='m'
      else exit
      fi


      if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
      if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

      dbaccess ksnet<<! 1> /dev/null 2> /dev/null
         set isolation to dirty read;
         unload to $TOOL/tmp/droptab.tmp delimiter ' '
         select first 1 to_char( today - $period - $minus, "%y%m%d" ) tabdate from dual;
!

      export dday=`cat $TOOL/tmp/droptab.tmp`

      if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

      for i in `cat ~informix/SCHEMA/tables_d_$period$bu`
      do
         dbaccess ksnet<<! 1> /dev/null 2> /dev/null
            set isolation to dirty read;
            unload to $TOOL/tmp/droptab.tmp delimiter ' '
            select tabname from systables
             where tabid > 99 and tabtype='T'
               and tabname like '$i%'
               and tabname < '$i$dday'
               and length(tabname) = length('$i$dday')
               and tabname != '${i}yymmdd';
!
         cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
         if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
      done


      #############################
      #   TLFë¥¼ Gë§ˆì¼“ìš©ìœ¼ë¡œ ì „í™˜
      #############################
      if [ x$bu = 'xg' ]; then

         echo
         echo 'ì˜¤ëŠ˜ì€ '`date +"$ymd"`
         echo '------------------------------'
         echo '[5mGë§ˆì¼“ ì „ìš©ìœ¼ë¡œ ì „í™˜í•  TLF í…Œì´ë¸”ë“¤ ì…ë‹ˆë‹¤. (í•´ë‹¹ 21ì¼ë¶„)[0m'
         echo '------------------------------'

         tail -21 $TOOL/tmp/droptab.sql > $TOOL/tmp/droptab.tmp
         mv $TOOL/tmp/droptab.tmp $TOOL/tmp/droptab.sql
         cat $TOOL/tmp/droptab.sql

         echo '------------------------------'
         echo
         echo 'ì „í™˜í• ê¹Œìš”? \c'
         read yn


         if [ $yn = 'y' ]
         then

            for g in `cat $TOOL/tmp/droptab.sql`
            do
               # Gë§ˆì¼“ ì „ìš© tableì„ ì‘ì—…ì—ì„œ ì œì™¸ (List ì¤‘ì—ì„œ)
               if [ `ds $g | grep data500dbs | wc -l` -gt 0 ]
               then

                  # Gë§ˆì¼“ ì „ìš© table ìƒì„±
                  if [ -f $TOOL/tmp/gmarket.sql ]; then rm $TOOL/tmp/gmarket.sql; fi
                  ds $g | sed -e '/^$/,$d' -e 's/data500dbs  extent size 500000 next size 500000/data10dbs  extent size 10000 next size 10000/g' -e 's/'$g'/new_'$g'/g' > $TOOL/tmp/gmarket.sql
                  dbaccess ksnet $TOOL/tmp/gmarket.sql
                  if [ -f $TOOL/tmp/gmarket.sql ]; then rm $TOOL/tmp/gmarket.sql; fi

                  # Gë§ˆì¼“ ì „ìš© Tableë¡œ Gë§ˆì¼“ TLFë§Œ ì´ê´€
                  $TOOL/bin/dbcopy -f 10000 -l $g.err -h $INFORMIXSERVER -H $INFORMIXSERVER -d ksnet -D ksnet -t $g -T new_$g -s "select * from $g where tax_pers_numb [1,3] in ($TAX_PERS_NUMB)"

                  # Gë§ˆì¼“ ì „ìš© Tableì— Index ìƒì„±
                  ds $g | sed -e '1,/revoke/d' -e 's/'$g'/new_'$g'/g' > $TOOL/tmp/gmarket.sql
                  dbaccess ksnet $TOOL/tmp/gmarket.sql
                  if [ -f $TOOL/tmp/gmarket.sql ]; then rm $TOOL/tmp/gmarket.sql; fi

                  # Gë§ˆì¼“ ì „ìš© Table í†µê³„ì •ë³´ ê°±ì‹ 
                  dbaccess ksnet<<!
                     update statistics high for table new_$g;
!
                  # Gë§ˆì¼“ ì „ìš© Tableì„ cctlhë¡œ Rename
                  ds $g | grep "create" | sed -e "s/unique//g" -e "s/\"[A-z]*\".//g" | $CAWK -F ' ' '{ printf("rename %s %s to old_%s;\n", $2, $3, $3); }' > $TOOL/tmp/gmarket.sql
                  ds $g | grep "create" | sed -e "s/unique//g" -e "s/\"[A-z]*\".//g" | $CAWK -F ' ' '{ printf("rename %s new_%s to %s;\n", $2, $3, $3); }' >> $TOOL/tmp/gmarket.sql
                  dbaccess ksnet $TOOL/tmp/gmarket.sql

                  chkext $g
               else
                  echo $g'ëŠ” Gë§ˆì¼“ ì „ìš© Table ì…ë‹ˆë‹¤.'
               fi
            done

            echo 'ë°˜ë“œì‹œ old_cctlhyymmddë¥¼ ì§€ìš°ì„¸ìš”'
            echo 'n' | tablst2 old_cctlh
            echo

            if [ -f $TOOL/tmp/gmarket.sql ]; then rm $TOOL/tmp/gmarket.sql; fi

         else
            echo 'ê·¸ëƒ¥ ë‘¡ë‹ˆë‹¤'
         fi

      #############################
      #   Table ì‚­ì œ
      #############################       
      else  
               
         echo  
         echo 'ì˜¤ëŠ˜ì€ '`date +"$ymd"`
         echo '------------------------------'
         echo '[5mì§€ìš°ë ¤ê³  í•˜ëŠ” í…Œì´ë¸”ë“¤ ì…ë‹ˆë‹¤.[0m'
         echo '------------------------------'
                  
         cat $TOOL/tmp/droptab.sql
                  
         echo '------------------------------'
         echo
         echo 'ì§€ìš¸ê¹Œìš”? \c'
         read yn  

         if [ $yn = 'y' ]
         then     
                  
            echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
            echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

            dbaccess ksnet $TOOL/tmp/droptab.sql 
                  
         else        
            echo 'ê·¸ëƒ¥ ë‘¡ë‹ˆë‹¤'
         fi
                  
      fi          


   elif [ $yn -eq 2 ]; then 

      echo        
      echo '----------------------------------------'
      echo ' <PBì—…ë¬´ê³„> ì‚­ì œí•  í…Œì´ë¸” ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.'
      echo '----------------------------------------'
      echo '   [5m1) ê¸°ê°„ë§Œë£Œ 3ë‹¬ (ë‹¨ë§ì§‘ê³„ì´ë ¥)[0m'
      echo '   2) ë°±ì—…ì™„ë£Œ 3ë‹¬ (ê³µì¸ì¸ì¦MPI)'
      echo '   3) ë°±ì—…ì™„ë£Œ 6ë‹¬ (PGì›”í…Œì´ë¸”)'
      echo '   4) ë°±ì—…ì™„ë£Œ 1ë…„ (PGí˜„ê¸ˆì˜ìˆ˜ì¦)'
      if [ $INFORMIXSERVER = 'pbsec01_tcp' ] || [ $INFORMIXSERVER = 'pbtst01_tcp' ]; then
         echo '   [5m5) ê¸°ê°„ë§Œë£Œ 6ë‹¬ (ëª¨ë‹ˆí„°ë§ ë“±)[0m'
      fi    
      echo '----------------------------------------'
      echo ' >> \c'
      read yn

      if [ $yn = "1" ];   then export period=3 ; export bu=''
      elif [ $yn = "2" ]; then export period=3; export bu='b'
      elif [ $yn = "3" ]; then export period=6; export bu='b'
      elif [ $yn = "4" ]; then export period=12; export bu='b'
      elif [ $yn = "5" ]; then export period=6; export bu='m'
      else exit
      fi

      if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
      if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

      dbaccess ksnet<<! 1> /dev/null 2> /dev/null
         set isolation to dirty read;
         unload to $TOOL/tmp/droptab.tmp delimiter ' '
         select first 1 to_char( today - interval(`expr $period + $minus`) month to month, "%y%m" ) tabdate from dual;
!

      export themonth=`cat $TOOL/tmp/droptab.tmp`

      if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

      for i in `cat ~informix/SCHEMA/tables_m_$period$bu`
      do
         dbaccess ksnet<<! 1> /dev/null 2> /dev/null
            set isolation to dirty read;
            unload to $TOOL/tmp/droptab.tmp delimiter ' '
            select tabname from systables
             where tabid > 99 and tabtype='T'
               and tabname like '$i%'
               and tabname < '$i$themonth'
               and length(tabname) = length('$i$themonth')
               and tabname != '${i}yymm';
!
         cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
         if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
      done

      echo
      echo 'ì˜¤ëŠ˜ì€ '`date +"$ymd"`
      echo '------------------------------'
      echo '[5mì§€ìš°ë ¤ê³  í•˜ëŠ” í…Œì´ë¸”ë“¤ ì…ë‹ˆë‹¤.[0m'
      echo '------------------------------'

      cat $TOOL/tmp/droptab.sql

      echo '------------------------------'
      echo
      echo 'ì§€ìš¸ê¹Œìš”? \c'
      read yn


      if [ $yn = 'y' ]
      then

         echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
         echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

         dbaccess ksnet $TOOL/tmp/droptab.sql

      else
         echo 'ê·¸ëƒ¥ ë‘¡ë‹ˆë‹¤'
      fi

   elif [ $yn -eq 0 ]; then

      echo
      echo 'ë¹ ì´ë¹ ì´...Goodbye ~~~~ ^oo^'
      exit

   else

      echo
      echo 'ì˜ëª» ì…ë ¥ í•˜ì…¨ìŠµë‹ˆë‹¤.'
      exit

   fi


###########################################
#   ì •ë³´ê³„
###########################################

elif [ $INFORMIXSERVER = 'mst02_tcp' ] || [ $INFORMIXSERVER = 'tst2_tcp' ]
then 
	
	echo
	echo '<< ì •ë³´ê³„ >>'
	echo '-------------------------------------------'
	echo '     ì‚­ì œí•  í…Œì´ë¸”ì˜ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”'
	echo '-------------------------------------------'
	echo '     1) ì¼ ì£¼ê¸° í…Œì´ë¸”'
	echo '     2) ì›” ì£¼ê¸° í…Œì´ë¸”'
	echo '     0) ë¹ ì ¸ ë‚˜ê°€ê¸°'
	echo '-------------------------------------------'
	echo '     > \c'
	read yn
	echo

	if [ $yn -eq 1 ]; then

		echo
		echo '----------------------------------------'
		echo '   ì‚­ì œí•  í…Œì´ë¸” ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.'
		echo '----------------------------------------'
		echo '   [5m1) ê¸°ê°„ë§Œë£Œ 1ì£¼ì¼  (ì§€ì—°ì²˜ë¦¬ ë“±)[0m'
		echo '   [5m2) ê¸°ê°„ë§Œë£Œ í•œë‹¬   (DDC,EDI ë“±)[0m'
		echo '   3) ë°±ì—…ì™„ë£Œ 1ì£¼ì¼  (ëŒ€í–‰ìŠ¹ì¸ ë“±)'
		echo '   4) ë°±ì—…ì™„ë£Œ í•œë‹¬   (PDI ë“±)'
		echo '   5) ë°±ì—…ì™„ë£Œ ë‘ë‹¬   (ë°°ì¹˜ìŠ¹ì¸ ë“±)'
		echo '   6) ë°±ì—…ì™„ë£Œ ì—¬ì„¯ë‹¬ (ì·¨ì†Œë‚´ì—­ ë“±)'
		echo '----------------------------------------'
		echo ' >> \c'
		read yn

		if [ $yn = "1" ];   then export period=7 ; export bu=''
		elif [ $yn = "2" ]; then export period=31; export bu=''
		elif [ $yn = "3" ]; then export period=7; export bu='b'
		elif [ $yn = "4" ]; then export period=31 ; export bu='b'
		elif [ $yn = "5" ]; then export period=62; export bu='b'
		elif [ $yn = "6" ]; then export period=184; export bu='b'
		else exit
		fi

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

		dbaccess ksnet<<! 1> /dev/null 2> /dev/null
			set isolation to dirty read;
			unload to $TOOL/tmp/droptab.tmp delimiter ' '
			select first 1 to_char( today - $period - $minus, "%Y%m%d" ) tabdate from dual;
!

		export dday=`cat $TOOL/tmp/droptab.tmp`

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

		for i in `cat ~informix/SCHEMA/tables_d_$period$bu`
		do
			dbaccess ksnet<<! 1> /dev/null 2> /dev/null
				set isolation to dirty read;
				unload to $TOOL/tmp/droptab.tmp delimiter ' '
				select tabname from systables
				 where tabid > 99 and tabtype='T'
				   and tabname like '$i%'
				   and tabname < '$i$dday'
				   and length(tabname) = length('$i$dday')
				   and tabname != '${i}yyyymmdd';
!
			cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
			if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		done

		echo
		echo 'ì˜¤ëŠ˜ì€ '`date +"$ymd"`
		echo '------------------------------'
		echo '[5mì§€ìš°ë ¤ê³  í•˜ëŠ” í…Œì´ë¸”ë“¤ ì…ë‹ˆë‹¤.[0m'
		echo '------------------------------'

		cat $TOOL/tmp/droptab.sql

		echo '------------------------------'
		echo
		echo 'ì§€ìš¸ê¹Œìš”? \c'
		read yn

		if [ $yn = 'y' ]
		then 

			echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
			echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

			dbaccess ksnet $TOOL/tmp/droptab.sql 

		else
			echo 'ê·¸ëƒ¥ ë‘¡ë‹ˆë‹¤'
		fi

	elif [ $yn -eq 2 ]; then 

		echo
		echo '----------------------------------------'
		echo '   ì‚­ì œí•  í…Œì´ë¸” ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.'
		echo '----------------------------------------'
		echo '   [5m1) ê¸°ê°„ë§Œë£Œ ë‘ë‹¬   (ë§ˆì´ì¥ë¶€ ë“±)[0m'
		echo '   [5m2) ê¸°ê°„ë§Œë£Œ ë‘ë‹¬   (ë²•ì¸ì¹´ë“œ ë“±)[0m'
		echo '   [5m3) ê¸°ê°„ë§Œë£Œ ì—¬ì„¯ë‹¬ (Okgiro ë“±)[0m'
		echo '   4) ë°±ì—…ì™„ë£Œ ì—¬ì„¯ë‹¬ (TLF,DDC ë“±)'
		echo '   5) ë°±ì—…ì™„ë£Œ ì¼ë…„   (salemoney)'
		echo '   6) ë°±ì—…ì™„ë£Œ ì´ë…„   (ê°•í˜¸ìˆ˜ ë“±)'
		echo '   7) ë°±ì—…ì™„ë£Œ ì‚¼ë…„   (ë¶€ê°€ì„¸ ë“±)'
		echo '   8) ë°±ì—…ì™„ë£Œ ì˜¤ë…„   (ì „í‘œì§‘ê³„ ë“±)'
		echo '----------------------------------------'
		echo ' >> \c'
		read yn

		if   [ $yn = "1" ]; then export period=2 ; export bu=''
		elif [ $yn = "2" ]; then export period=5 ; export bu=''
		elif [ $yn = "3" ]; then export period=6 ; export bu=''
		elif [ $yn = "4" ]; then export period=6 ; export bu='b'
		elif [ $yn = "5" ]; then export period=12; export bu='b'
		elif [ $yn = "6" ]; then export period=24; export bu='b'
		elif [ $yn = "7" ]; then export period=36; export bu='b'
		elif [ $yn = "8" ]; then export period=60; export bu='b'
		else exit
		fi

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

		dbaccess ksnet<<! 1> /dev/null 2> /dev/null
			set isolation to dirty read;
			unload to $TOOL/tmp/droptab.tmp delimiter ' '
			select first 1 to_char( today - interval(`expr $period + $minus`) month to month, "%Y%m" ) tabdate from dual;
!

		export themonth=`cat $TOOL/tmp/droptab.tmp`

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

		for i in `cat ~informix/SCHEMA/tables_m_$period$bu`
		do
			dbaccess ksnet<<! 1> /dev/null 2> /dev/null
				set isolation to dirty read;
				unload to $TOOL/tmp/droptab.tmp delimiter ' '
				select tabname from systables
				 where tabid > 99 and tabtype='T'
				   and tabname like '$i%'
				   and tabname < '$i$themonth'
				   and length(tabname) = length('$i$themonth')
				   and tabname != '${i}yyyymm';
!
			cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
			if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		done

		echo
		echo 'ì˜¤ëŠ˜ì€ '`date +"$ymd"`
		echo '------------------------------'
		echo '[5mì§€ìš°ë ¤ê³  í•˜ëŠ” í…Œì´ë¸”ë“¤ ì…ë‹ˆë‹¤.[0m'
		echo '------------------------------'

		cat $TOOL/tmp/droptab.sql

		echo '------------------------------'
		echo
		echo 'ì§€ìš¸ê¹Œìš”? \c'
		read yn

		if [ $yn = 'y' ]
		then 

			echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
			echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

			dbaccess ksnet $TOOL/tmp/droptab.sql 

		else
			echo 'ê·¸ëƒ¥ ë‘¡ë‹ˆë‹¤'
		fi

	elif [ $yn -eq 0 ]; then 

		echo
		echo 'ë¹ ì´ë¹ ì´'
		exit

	else

		echo
		echo 'ì˜ëª» ì…ë ¥ í•˜ì…¨ìŠµë‹ˆë‹¤.'
		exit

	fi
	

###########################################
#   ì—…ë¬´ê³„
###########################################

elif [ $INFORMIXSERVER = 'mst01_tcp' ] || [ $INFORMIXSERVER = 'oldsos' ] || [ $INFORMIXSERVER = 'neoecs' ] || [ $INFORMIXSERVER = 'tst_tcp' ]; then

	echo
	echo '<< ì—…ë¬´ê³„ >>'
	echo '-------------------------------------------'
	echo '     ì‚­ì œí•  í…Œì´ë¸”ì˜ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”'
	echo '-------------------------------------------'
	echo '     1) ì¼ ì£¼ê¸° í…Œì´ë¸”'
	echo '     2) ì›” ì£¼ê¸° í…Œì´ë¸”'
	echo '     0) ë¹ ì ¸ ë‚˜ê°€ê¸°'
	echo '-------------------------------------------'
	echo '     > \c'
	read yn
	echo

	if [ $yn -eq 1 ]; then

		echo
		echo '----------------------------------------'
		echo '   ì‚­ì œí•  í…Œì´ë¸” ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.'
		echo '----------------------------------------'
		echo '   [5m1) ê¸°ê°„ë§Œë£Œ 1ì£¼ì¼ (ì§€ì—°ì²˜ë¦¬ ë“±)[0m'
		echo '   [5m2) ê¸°ê°„ë§Œë£Œ í•œë‹¬  (ê±°ë˜ë‚´ì—­ ë“±)[0m'
		echo '   3) ë°±ì—…ì™„ë£Œ í•œë‹¬  (ì§ë¶ˆ,êµ¬ë§¤ ë“±)'
		echo '   4) ë°±ì—…ì™„ë£Œ ì„ë‹¬  (í¬ì¸íŠ¸ ë“±)'
		echo '   5) ë°±ì—…ì™„ë£Œ 12ê°œì›” (ê°€ë§¹ì  ê±°ë˜ê³ ìœ ë²ˆí˜¸ ë“±)'
		echo '   6) ë°±ì—…ì™„ë£Œ 24ê°œì›” (ìŠ¹ì¸ ë“±)'
		echo '   7) TLF Gë§ˆì¼“ ì „ìš©ìœ¼ë¡œ ì „í™˜ 3ê°œì›”'
		if [ $INFORMIXSERVER = 'oldsos' ] || [ $INFORMIXSERVER = 'neoecs' ]; then
			echo '   [5m8) ê¸°ê°„ë§Œë£Œ 1ì£¼ì¼ (ëª¨ë‹ˆí„°ë§ ë“±)[0m'
		fi
		echo '----------------------------------------'
		echo ' >> \c'
		read yn

		if [ $yn = "1" ];   then export period=7 ;  export bu=''
		elif [ $yn = "2" ]; then export period=31;  export bu=''
		elif [ $yn = "3" ]; then export period=31;  export bu='b'
		elif [ $yn = "4" ]; then export period=92;  export bu='b'
		elif [ $yn = "5" ]; then export period=366; export bu='b'
		elif [ $yn = "6" ]; then export period=730; export bu='b'
		elif [ $yn = "7" ]; then export period=92;  export bu='g'
		elif [ $yn = "8" ]; then export period=7;   export bu='m'
		else exit
		fi

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

		dbaccess ksnet<<! 1> /dev/null 2> /dev/null
			set isolation to dirty read;
			unload to $TOOL/tmp/droptab.tmp delimiter ' '
			select first 1 to_char( today - $period - $minus, "%y%m%d" ) tabdate from dual;
!

		export dday=`cat $TOOL/tmp/droptab.tmp`

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

		for i in `cat ~informix/SCHEMA/tables_d_$period$bu`
		do
			dbaccess ksnet<<! 1> /dev/null 2> /dev/null
				set isolation to dirty read;
				unload to $TOOL/tmp/droptab.tmp delimiter ' '
				select tabname from systables
				 where tabid > 99 and tabtype='T'
				   and tabname like '$i%'
				   and tabname < '$i$dday'
				   and length(tabname) = length('$i$dday')
				   and tabname != '${i}yymmdd';
!
			cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
			if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		done
		
		#############################
		#   TLFë¥¼ Gë§ˆì¼“ìš©ìœ¼ë¡œ ì „í™˜
		#############################
		if [ x$bu = 'xg' ]; then

			echo
			echo 'ì˜¤ëŠ˜ì€ '`date +"$ymd"`
			echo '------------------------------'
			echo '[5mGë§ˆì¼“ ì „ìš©ìœ¼ë¡œ ì „í™˜í•  TLF í…Œì´ë¸”ë“¤ ì…ë‹ˆë‹¤. (í•´ë‹¹ 21ì¼ë¶„)[0m'
			echo '------------------------------'

			tail -21 $TOOL/tmp/droptab.sql > $TOOL/tmp/droptab.tmp
			mv $TOOL/tmp/droptab.tmp $TOOL/tmp/droptab.sql
			cat $TOOL/tmp/droptab.sql

			echo '------------------------------'
			echo
			echo 'ì „í™˜í• ê¹Œìš”? \c'
			read yn

			if [ $yn = 'y' ]
			then 

				for g in `cat $TOOL/tmp/droptab.sql`
				do
					# Gë§ˆì¼“ ì „ìš© tableì„ ì‘ì—…ì—ì„œ ì œì™¸ (List ì¤‘ì—ì„œ)
					if [ `ds $g | grep data500dbs | wc -l` -gt 0 ]
					then
					
						# Gë§ˆì¼“ ì „ìš© table ìƒì„±
						if [ -f $TOOL/tmp/gmarket.sql ]; then rm $TOOL/tmp/gmarket.sql; fi
						ds $g | sed -e '/^$/,$d' -e 's/data500dbs  extent size 500000 next size 500000/data10dbs  extent size 10000 next size 10000/g' -e 's/'$g'/new_'$g'/g' > $TOOL/tmp/gmarket.sql
						dbaccess ksnet $TOOL/tmp/gmarket.sql
						if [ -f $TOOL/tmp/gmarket.sql ]; then rm $TOOL/tmp/gmarket.sql; fi
						
						# Gë§ˆì¼“ ì „ìš© Tableë¡œ Gë§ˆì¼“ TLFë§Œ ì´ê´€
						$TOOL/bin/dbcopy -f 10000 -l $g.err -h $INFORMIXSERVER -H $INFORMIXSERVER -d ksnet -D ksnet -t $g -T new_$g -s "select * from $g where tax_pers_numb [1,3] in ($TAX_PERS_NUMB)"
					
						# Gë§ˆì¼“ ì „ìš© Tableì— Index ìƒì„±
						ds $g | sed -e '1,/revoke/d' -e 's/'$g'/new_'$g'/g' > $TOOL/tmp/gmarket.sql
						dbaccess ksnet $TOOL/tmp/gmarket.sql
						if [ -f $TOOL/tmp/gmarket.sql ]; then rm $TOOL/tmp/gmarket.sql; fi
							
						# Gë§ˆì¼“ ì „ìš© Table í†µê³„ì •ë³´ ê°±ì‹ 
						dbaccess ksnet<<!
							update statistics high for table new_$g;
!
					
						# Gë§ˆì¼“ ì „ìš© Tableì„ cctlhë¡œ Rename
						ds $g | grep "create" | sed -e "s/unique//g" -e "s/\"[A-z]*\".//g" | $CAWK -F ' ' '{ printf("rename %s %s to old_%s;\n", $2, $3, $3); }' > $TOOL/tmp/gmarket.sql
						ds $g | grep "create" | sed -e "s/unique//g" -e "s/\"[A-z]*\".//g" | $CAWK -F ' ' '{ printf("rename %s new_%s to %s;\n", $2, $3, $3); }' >> $TOOL/tmp/gmarket.sql
						dbaccess ksnet $TOOL/tmp/gmarket.sql
						
						chkext $g
					else
						echo $g'ëŠ” Gë§ˆì¼“ ì „ìš© Table ì…ë‹ˆë‹¤.'
					fi
				done
				
				echo 'ë°˜ë“œì‹œ old_cctlhyymmddë¥¼ ì§€ìš°ì„¸ìš”'
				echo 'n' | tablst2 old_cctlh
				echo
				
				if [ -f $TOOL/tmp/gmarket.sql ]; then rm $TOOL/tmp/gmarket.sql; fi

			else
				echo 'ê·¸ëƒ¥ ë‘¡ë‹ˆë‹¤'
			fi

		#############################
		#   Table ì‚­ì œ
		#############################			
		else

			echo
			echo 'ì˜¤ëŠ˜ì€ '`date +"$ymd"`
			echo '------------------------------'
			echo '[5mì§€ìš°ë ¤ê³  í•˜ëŠ” í…Œì´ë¸”ë“¤ ì…ë‹ˆë‹¤.[0m'
			echo '------------------------------'

			cat $TOOL/tmp/droptab.sql

			echo '------------------------------'
			echo
			echo 'ì§€ìš¸ê¹Œìš”? \c'
			read yn

			if [ $yn = 'y' ]
			then 

				echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
				echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

				dbaccess ksnet $TOOL/tmp/droptab.sql 

			else
				echo 'ê·¸ëƒ¥ ë‘¡ë‹ˆë‹¤'
			fi
						
		fi

	elif [ $yn -eq 2 ]; then 

		echo
		echo '----------------------------------------'
		echo '   ì‚­ì œí•  í…Œì´ë¸” ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.'
		echo '----------------------------------------'
		echo '   [5m1) ê¸°ê°„ë§Œë£Œ 3ë‹¬ (ë‹¨ë§ì§‘ê³„ì´ë ¥)[0m'
		echo '   2) ë°±ì—…ì™„ë£Œ 3ë‹¬ (ê³µì¸ì¸ì¦MPI)'
		echo '   3) ë°±ì—…ì™„ë£Œ 6ë‹¬ (PGì›”í…Œì´ë¸”)'
		echo '   4) ë°±ì—…ì™„ë£Œ 1ë…„ (PGí˜„ê¸ˆì˜ìˆ˜ì¦)'
		if [ $INFORMIXSERVER = 'oldsos' ] || [ $INFORMIXSERVER = 'neoecs' ]; then
			echo '   [5m5) ê¸°ê°„ë§Œë£Œ 6ë‹¬ (ëª¨ë‹ˆí„°ë§ ë“±)[0m'
		fi
		echo '----------------------------------------'
		echo ' >> \c'
		read yn

		if [ $yn = "1" ];   then export period=3 ; export bu=''
		elif [ $yn = "2" ]; then export period=3; export bu='b'
		elif [ $yn = "3" ]; then export period=6; export bu='b'
		elif [ $yn = "4" ]; then export period=12; export bu='b'
		elif [ $yn = "5" ]; then export period=6; export bu='m'
		else exit
		fi

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

		dbaccess ksnet<<! 1> /dev/null 2> /dev/null
			set isolation to dirty read;
			unload to $TOOL/tmp/droptab.tmp delimiter ' '
			select first 1 to_char( today - interval(`expr $period + $minus`) month to month, "%y%m" ) tabdate from dual;
!

		export themonth=`cat $TOOL/tmp/droptab.tmp`

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

		for i in `cat ~informix/SCHEMA/tables_m_$period$bu`
		do
			dbaccess ksnet<<! 1> /dev/null 2> /dev/null
				set isolation to dirty read;
				unload to $TOOL/tmp/droptab.tmp delimiter ' '
				select tabname from systables
				 where tabid > 99 and tabtype='T'
				   and tabname like '$i%'
				   and tabname < '$i$themonth'
				   and length(tabname) = length('$i$themonth')
				   and tabname != '${i}yymm';
!
			cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
			if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		done

		echo
		echo 'ì˜¤ëŠ˜ì€ '`date +"$ymd"`
		echo '------------------------------'
		echo '[5mì§€ìš°ë ¤ê³  í•˜ëŠ” í…Œì´ë¸”ë“¤ ì…ë‹ˆë‹¤.[0m'
		echo '------------------------------'

		cat $TOOL/tmp/droptab.sql

		echo '------------------------------'
		echo
		echo 'ì§€ìš¸ê¹Œìš”? \c'
		read yn

		if [ $yn = 'y' ]
		then 

			echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
			echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

			dbaccess ksnet $TOOL/tmp/droptab.sql 

		else
			echo 'ê·¸ëƒ¥ ë‘¡ë‹ˆë‹¤'
		fi

	elif [ $yn -eq 0 ]; then 

		echo
		echo 'ë¹ ì´ë¹ ì´'
		exit

	else

		echo
		echo 'ì˜ëª» ì…ë ¥ í•˜ì…¨ìŠµë‹ˆë‹¤.'
		exit

	fi



###########################################
#   ì •ë³´ê³„ ì œ2ì„œë²„(ì „ìì„œëª… DB)
###########################################

elif [ $INFORMIXSERVER = 'desc01_tcp' ]
then

   echo
   echo '<< ì „ìì„œëª… DB >>'
   echo '-------------------------------------------'
   echo '     ì‚­ì œí•  í…Œì´ë¸”ì˜ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”'
   echo '-------------------------------------------'
   echo '     1) ì¼ ì£¼ê¸° í…Œì´ë¸”'
   echo '     2) ì›” ì£¼ê¸° í…Œì´ë¸”'
   echo '     0) ë¹ ì ¸ ë‚˜ê°€ê¸°'
   echo '-------------------------------------------'
   echo '     > \c'
   read yn
   echo

    if [ $yn -eq 1 ]; then

        echo
        echo '----------------------------------------'
        echo '   ì‚­ì œí•  í…Œì´ë¸” ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.'
        echo '----------------------------------------'
        echo '   4) ë°±ì—…ì™„ë£Œ í•œë‹¬   (signrtlh,descë“±)'
        echo '----------------------------------------'
        echo ' >> \c'
        read yn


        if [ $yn = "1" ];   then export period=7 ; export bu=''
        elif [ $yn = "2" ]; then export period=31; export bu=''
        elif [ $yn = "3" ]; then export period=7; export bu='b'
        elif [ $yn = "4" ]; then export period=31 ; export bu='b'
        elif [ $yn = "5" ]; then export period=62; export bu='b'
        elif [ $yn = "6" ]; then export period=184; export bu='b'
        else exit
        fi

        if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
        if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

        dbaccess ksnet<<! 1> /dev/null 2> /dev/null
            set isolation to dirty read;
            unload to $TOOL/tmp/droptab.tmp delimiter ' '
            select first 1 to_char( today - $period - $minus, "%Y%m%d" ) tabdate from dual;
!

        export dday=`cat $TOOL/tmp/droptab.tmp`

        if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

        for i in `cat ~informix/SCHEMA/DESC/tables_d_$period$bu`
        do
            dbaccess ksnet<<! 1> /dev/null 2> /dev/null
                set isolation to dirty read;
                unload to $TOOL/tmp/droptab.tmp delimiter ' '
                select tabname from systables
                 where tabid > 99 and tabtype='T'
                   and tabname like '$i%'
                   and tabname < '$i$dday'
                   and length(tabname) = length('$i$dday')
                   and tabname != '${i}yyyymmdd';
!

            cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
            if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
        done

        echo
        echo 'ì˜¤ëŠ˜ì€ '`date +"$ymd"`
        echo '------------------------------'
        echo '[5mì§€ìš°ë ¤ê³  í•˜ëŠ” í…Œì´ë¸”ë“¤ ì…ë‹ˆë‹¤.[0m'
        echo '------------------------------'

        cat $TOOL/tmp/droptab.sql

        echo '------------------------------'
        echo
        echo 'ì§€ìš¸ê¹Œìš”? \c'
        read yn

        if [ $yn = 'y' ]
        then

            echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
            echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

            dbaccess ksnet $TOOL/tmp/droptab.sql

        else
            echo 'ê·¸ëƒ¥ ë‘¡ë‹ˆë‹¤'
        fi


    elif [ $yn -eq 2 ]; then

        echo
        echo '----------------------------------------'
        echo '   ì‚­ì œí•  í…Œì´ë¸” ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.'
        echo '----------------------------------------'
       # echo '   [5m1) ê¸°ê°„ë§Œë£Œ ë‘ë‹¬   (ë§ˆì´ì¥ë¶€ ë“±)[0m'
       # echo '   [5m2) ê¸°ê°„ë§Œë£Œ ë‘ë‹¬   (ë²•ì¸ì¹´ë“œ ë“±)[0m'
       # echo '   3) ë°±ì—…ì™„ë£Œ ì—¬ì„¯ë‹¬ (TLF,DDC ë“±)'
       # echo '   4) ë°±ì—…ì™„ë£Œ ì¼ë…„   (salemoney)'
       # echo '   5) ë°±ì—…ì™„ë£Œ ì´ë…„   (ê°•í˜¸ìˆ˜ ë“±)'
       # echo '   6) ë°±ì—…ì™„ë£Œ ì‚¼ë…„   (ë¶€ê°€ì„¸ ë“±)'
       # echo '   7) ë°±ì—…ì™„ë£Œ ì˜¤ë…„   (ì „í‘œì§‘ê³„ ë“±)'
        echo '   97) í•´ë‹¹ì‚¬í•­ ì—†ìŒ. '
        echo '----------------------------------------'
        echo ' >> \c'
        read yn


        if   [ $yn = "1" ]; then export period=2 ; export bu=''
        elif [ $yn = "2" ]; then export period=5 ; export bu=''
        elif [ $yn = "3" ]; then export period=6 ; export bu='b'
        elif [ $yn = "4" ]; then export period=12; export bu='b'
        elif [ $yn = "5" ]; then export period=24; export bu='b'
        elif [ $yn = "6" ]; then export period=36; export bu='b'
        elif [ $yn = "7" ]; then export period=60; export bu='b'
        else exit
        fi

        if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
        if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi


        dbaccess ksnet<<! 1> /dev/null 2> /dev/null
            set isolation to dirty read;
            unload to $TOOL/tmp/droptab.tmp delimiter ' '
            select first 1 to_char( today - interval(`expr $period + $minus`) month to month, "%Y%m" ) tabdate from dual;
!

        export themonth=`cat $TOOL/tmp/droptab.tmp`

        if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

        for i in `cat ~informix/SCHEMA/DESC/tables_m_$period$bu`
        do
            dbaccess ksnet<<! 1> /dev/null 2> /dev/null
                set isolation to dirty read;
                unload to $TOOL/tmp/droptab.tmp delimiter ' '
                select tabname from systables
                 where tabid > 99 and tabtype='T'
                   and tabname like '$i%'
                   and tabname < '$i$themonth'
                   and length(tabname) = length('$i$themonth')
                   and tabname != '${i}yyyymm';
!
            cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
            if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
        done

        echo
        echo 'ì˜¤ëŠ˜ì€ '`date +"$ymd"`
        echo '------------------------------'
        echo '[5mì§€ìš°ë ¤ê³  í•˜ëŠ” í…Œì´ë¸”ë“¤ ì…ë‹ˆë‹¤.[0m'
        echo '------------------------------'

        cat $TOOL/tmp/droptab.sql

        echo '------------------------------'
        echo
        echo 'ì§€ìš¸ê¹Œìš”? \c'
        read yn

        if [ $yn = 'y' ]
        then
            echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
            echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

            dbaccess ksnet $TOOL/tmp/droptab.sql

        else
            echo 'ê·¸ëƒ¥ ë‘¡ë‹ˆë‹¤'
        fi

    elif [ $yn -eq 0 ]; then

        echo
        echo 'ë¹ ì´ë¹ ì´'
        exit

    else

        echo
        echo 'ì˜ëª» ì…ë ¥ í•˜ì…¨ìŠµë‹ˆë‹¤.'
        exit

    fi


###########################################
#   ì •ë³´ê³„ ì œ2ì„œë²„
###########################################

elif [ $INFORMIXSERVER = 'mst03_tcp' ]
then 
	
	echo
	echo '<< ë§ˆì´ì¥ë¶€ >>'
	echo '-------------------------------------------'
	echo '     ì‚­ì œí•  í…Œì´ë¸”ì˜ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”'
	echo '-------------------------------------------'
	echo '     2) ì›” ì£¼ê¸° í…Œì´ë¸”'
	echo '     0) ë¹ ì ¸ ë‚˜ê°€ê¸°'
	echo '-------------------------------------------'
	echo '     > \c'
	read yn
	echo

	if [ $yn -eq 2 ]; then 

		echo
		echo '----------------------------------------'
		echo '   ì‚­ì œí•  í…Œì´ë¸” ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.'
		echo '----------------------------------------'
		echo '   1) ë§ˆì´ì¥ë¶€ 2ë…„'
		echo '----------------------------------------'
		echo ' >> \c'
		read yn

		if [ $yn = "1" ];   then export period=24 ; export bu='b'
		else exit
		fi

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

		dbaccess ksnet<<! 1> /dev/null 2> /dev/null
			set isolation to dirty read;
			unload to $TOOL/tmp/droptab.tmp delimiter ' '
			select first 1 to_char( today - interval(`expr $period + $minus`) month to month, "%Y%m" ) tabdate from dual;
!

		export themonth=`cat $TOOL/tmp/droptab.tmp`

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

		for i in `cat ~informix/SCHEMA/M03/tables_m_$period$bu`
		do
			dbaccess ksnet<<! 1> /dev/null 2> /dev/null
				set isolation to dirty read;
				unload to $TOOL/tmp/droptab.tmp delimiter ' '
				select tabname from systables
 				 where tabid > 99 and tabtype='T'
				   and tabname like '$i%'
				   and tabname < '$i$themonth'
				   and length(tabname) = length('$i$themonth')
				   and tabname != '${i}yyyymm';
!
			cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
			if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		done

		echo
		echo 'ì˜¤ëŠ˜ì€ '`date +"$ymd"`
		echo '------------------------------'
		echo '[5mì§€ìš°ë ¤ê³  í•˜ëŠ” í…Œì´ë¸”ë“¤ ì…ë‹ˆë‹¤.[0m'
		echo '------------------------------'

		cat $TOOL/tmp/droptab.sql

		echo '------------------------------'
		echo
		echo 'ì§€ìš¸ê¹Œìš”? \c'
		read yn

		if [ $yn = 'y' ]
		then 

			echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
			echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

			dbaccess ksnet $TOOL/tmp/droptab.sql 

		else
			echo 'ê·¸ëƒ¥ ë‘¡ë‹ˆë‹¤'
		fi

	elif [ $yn -eq 0 ]; then 

		echo
		echo 'ë¹ ì´ë¹ ì´'
		exit

	else

		echo
		echo 'ì˜ëª» ì…ë ¥ í•˜ì…¨ìŠµë‹ˆë‹¤.'
		exit

	fi


###########################################
#   ì‹  ë§ˆì´ì¥ë¶€
###########################################

elif [ $INFORMIXSERVER = 'henry_tcp' ]
then 

	# ì‹  ë§ˆì´ì¥ë¶€ ì´ê´€ ì¤‘ì´ë¯€ë¡œ Block ######
	echo 'ì§€ìš°ì§€ ë§ˆì„¸ìš”'
	exit
	########################################
	
	echo
	echo '<< ì‹  ë§ˆì´ì¥ë¶€ >>'
	echo '-------------------------------------------'
	echo '     ì‚­ì œí•  í…Œì´ë¸”ì˜ ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”'
	echo '-------------------------------------------'
	echo '     1) ì¼ ì£¼ê¸° í…Œì´ë¸”'
	echo '     2) ì›” ì£¼ê¸° í…Œì´ë¸”'
	echo '     0) ë¹ ì ¸ ë‚˜ê°€ê¸°'
	echo '-------------------------------------------'
	echo '     > \c'
	read yn
	echo

	if [ $yn -eq 1 ]; then

		echo
		echo '----------------------------------------'
		echo '   ì‚­ì œí•  í…Œì´ë¸” ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.'
		echo '----------------------------------------'
		echo '   [5m1) ê¸°ê°„ë§Œë£Œ 1ì£¼ì¼  (í•˜ëª¨ë‹ˆ ë“±)[0m'
		echo '   [5m2) ê¸°ê°„ë§Œë£Œ 2ì£¼ì¼  (í•˜ëª¨ë‹ˆ TLF í›„ì²˜ë¦¬ ë“±)[0m'
		echo '----------------------------------------'
		echo ' >> \c'
		read yn

		if [ $yn = "1" ];   then export period=7 ; export bu=''
		elif [ $yn = "2" ];   then export period=14 ; export bu=''
		else exit
		fi

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

		dbaccess ksnet<<! 1> /dev/null 2> /dev/null
			set isolation to dirty read;
			unload to $TOOL/tmp/droptab.tmp delimiter ' '
			select first 1 to_char( today - $period - $minus, "%y%m%d" ) tabdate from dual;
!

		export dday=`cat $TOOL/tmp/droptab.tmp`

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

		for i in `cat ~informix/SCHEMA/tables_d_$period$bu`
		do
			dbaccess ksnet<<! 1> /dev/null 2> /dev/null
				set isolation to dirty read;
				unload to $TOOL/tmp/droptab.tmp delimiter ' '
				select tabname from systables
				 where tabid > 99 and tabtype='T'
				   and tabname like '$i%'
				   and tabname < '$i$dday'
				   and length(tabname) = length('$i$dday')
				   and tabname != '${i}yyyymmdd';
!
			cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
			if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		done

		echo
		echo 'ì˜¤ëŠ˜ì€ '`date +"$ymd"`
		echo '------------------------------'
		echo '[5mì§€ìš°ë ¤ê³  í•˜ëŠ” í…Œì´ë¸”ë“¤ ì…ë‹ˆë‹¤.[0m'
		echo '------------------------------'

		cat $TOOL/tmp/droptab.sql

		echo '------------------------------'
		echo
		echo 'ì§€ìš¸ê¹Œìš”? \c'
		read yn

		if [ $yn = 'y' ]
		then 

			echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
			echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

			dbaccess ksnet $TOOL/tmp/droptab.sql 

		else
			echo 'ê·¸ëƒ¥ ë‘¡ë‹ˆë‹¤'
		fi

	elif [ $yn -eq 2 ]; then  

		echo
		echo '----------------------------------------'
		echo '   ì‚­ì œí•  í…Œì´ë¸” ìœ í˜•ì„ ì„ íƒí•˜ì„¸ìš”.'
		echo '----------------------------------------'
		echo '   [5m1) ê¸°ê°„ë§Œë£Œ 6ë‹¬ (TLF ë“±)[0m'
		echo '   2) ë°±ì—…ì™„ë£Œ 1ë…„ (ì‹  ë§ˆì´ì¥ë¶€)'
		echo '----------------------------------------'
		echo ' >> \c'
		read yn

		if [ $yn = "1" ]; then export period=6 ; export bu=''
		elif [ $yn = "2" ]; then export period=12 ; export bu='b'
		else exit
		fi

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

		dbaccess ksnet<<! 1> /dev/null 2> /dev/null
			set isolation to dirty read;
			unload to $TOOL/tmp/droptab.tmp delimiter ' '
			select first 1 to_char( today - interval(`expr $period + $minus`) month to month, "%y%m" ) tabdate from dual;
!

		export themonth=`cat $TOOL/tmp/droptab.tmp`

		if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi

		for i in `cat ~informix/SCHEMA/tables_m_$period$bu`
		do
			dbaccess ksnet<<! 1> /dev/null 2> /dev/null
				set isolation to dirty read;
				unload to $TOOL/tmp/droptab.tmp delimiter ' '
				select tabname from systables
 				 where tabid > 99 and tabtype='T'
				   and tabname like '$i%'
				   and tabname < '$i$themonth'
				   and length(tabname) = length('$i$themonth')
				   and tabname != '${i}yyyymm';
!
			cat $TOOL/tmp/droptab.tmp >> $TOOL/tmp/droptab.sql
			if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
		done

		echo
		echo 'ì˜¤ëŠ˜ì€ '`date +"$ymd"`
		echo '------------------------------'
		echo '[5mì§€ìš°ë ¤ê³  í•˜ëŠ” í…Œì´ë¸”ë“¤ ì…ë‹ˆë‹¤.[0m'
		echo '------------------------------'

		cat $TOOL/tmp/droptab.sql

		echo '------------------------------'
		echo
		echo 'ì§€ìš¸ê¹Œìš”? \c'
		read yn

		if [ $yn = 'y' ]
		then 

			echo '1,$s/^/drop table /g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null
			echo '1,$s/$/;/g\nw\nq' | ed $TOOL/tmp/droptab.sql > /dev/null

			dbaccess ksnet $TOOL/tmp/droptab.sql 

		else
			echo 'ê·¸ëƒ¥ ë‘¡ë‹ˆë‹¤'
		fi

	elif [ $yn -eq 0 ]; then 

		echo
		echo 'ë¹ ì´ë¹ ì´'
		exit

	else

		echo
		echo 'ì˜ëª» ì…ë ¥ í•˜ì…¨ìŠµë‹ˆë‹¤.'
		exit

	fi

else

	echo 'í™˜ê²½ ì„¤ì •ì„ ë‹¤ì‹œ í™•ì¸í•˜ì„¸ìš” ^^'

fi

if [ -f $TOOL/tmp/droptab.tmp ]; then rm $TOOL/tmp/droptab.tmp; fi
if [ -f $TOOL/tmp/droptab.sql ]; then rm $TOOL/tmp/droptab.sql; fi

done ##### Main While Loop
